<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Generating Terrain (Part 1) - Introduction | luka712 blog</title><meta name="description" content="Introduction to BabylonJS and 3 part posts about creating terrain data."><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Generating Terrain (Part 1) - Introduction</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-06-15T22:00:00.000Z"> Saturday, June 16th 2018 at 0:00</time><br>Last updated on<time itemprop="dateModified" datetime="2018-06-15T22:00:00.000Z"> Sunday, June 24th 2018 at 13:23</time></span><p>While starting to write this blog I knew that I wanted something rendered in real time as part of blog. Among couple of options was flat shaded terrain, which is new experience for me as well, regardless, decided to write blog post about how I did in what is going to be 3 parts post. I was looking at couple of options how to do it and what technology to use. In the end decided to go with BabylonJS and simple Hill generating algorithm for terrain.</p>
<p><strong>Part 1</strong> will be all about BabylonJS introduction and rendering with custom polygons.Which meaans that vertexes, normals, vertex colors are all mentioned here briefly.</p>
<p><strong>Part 2</strong> is going to be about actual terrain hill generator.</p>
<p><strong>Part 3</strong> will be about adding some models and shadows to furher improve scene.</p>
<hr>
<h6 id="Why-BabylonJS"><a href="#Why-BabylonJS" class="headerlink" title="Why BabylonJS ?"></a>Why BabylonJS ?</h6><p>Simply because I had more experience with BabylonJS, compared to some similar engines like ThreeJS ( which is also great).<br>I could have also done this in WebGL, but BabylonJS provides right amount of abstraction, that allows me to focus only on terrain, instead of setting up whole renderer.</p>
<p>By the end of part 3 we should have something like this: </p>
<p><img src="/images/render.png" style="width:50%"></p>
<p>If you are already familiar with BabylonJS simply skip this part, since this is introduction with simple scene setup.</p>
<hr>
<h6 id="What-is-BabylonJS"><a href="#What-is-BabylonJS" class="headerlink" title="What is BabylonJS ?"></a>What is BabylonJS ?</h6><p>As defined on <a href="https://doc.babylonjs.com/" target="_blank" rel="noopener">BabylonJS page</a> it is “<em>An open source 3D engine based on WebGL and Javascript</em>“, meaning that it runs in browser and uses power of GPU to do crazy stuff.</p>
<p>To get started we’re going to need some html page with canvas element. I did add some CSS to make canvas element bigger, visible and without margins.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Add BabylonJS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.2.0/babylon.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- javascript file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CSS to make canvas full screen with some color --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    #renderCanvas&#123;</span></span><br><span class="line"><span class="undefined">        width: 100%;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">        background-color: cornflowerblue;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    html, body &#123;</span></span><br><span class="line"><span class="undefined">        margin: 0px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"renderCanvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Notice the <code>&lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;</code> within head section of html file. I have created <code>main.js</code> for my javascript code. Now within that file add the following:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"renderCanvas"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> engine = <span class="keyword">new</span> BABYLON.Engine(canvas, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createScene</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scene = <span class="keyword">new</span> BABYLON.Scene(engine);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> camera = <span class="keyword">new</span> BABYLON.TargetCamera(<span class="string">'camera'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">5</span>, <span class="number">-10</span>), scene);</span><br><span class="line">        camera.setTarget(BABYLON.Vector3.Zero());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> light = <span class="keyword">new</span> BABYLON.DirectionalLight(<span class="string">'light1'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>), scene);</span><br><span class="line">        light.position = <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sphere = BABYLON.MeshBuilder.CreateSphere(<span class="string">'sphere'</span>, &#123; <span class="attr">segments</span>: <span class="number">16</span>, <span class="attr">diameter</span>: <span class="number">2</span> &#125;, scene);</span><br><span class="line"></span><br><span class="line">        sphere.position.y = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> ground = BABYLON.MeshBuilder.CreateGround(<span class="string">'ground1'</span>, &#123; <span class="attr">height</span>: <span class="number">6</span>, <span class="attr">width</span>: <span class="number">6</span>, <span class="attr">subdivisions</span>: <span class="number">2</span> &#125;, scene);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scene;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> scene = createScene();</span><br><span class="line"></span><br><span class="line">    engine.runRenderLoop(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        scene.render();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        engine.resize();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This will setup simple scene with plane and sphere that looks like this:</p>
<p><img src="/images/scene_setup.png" style="width:50%"></p>
<p>Code that is added is rather simple. First we need something to fire up BabylonJS instance and rest of the code.<br>That is easily done with on load event. Now all other code will go inside <code>onload</code> function. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>First lines of code inside <code>onload</code> function should be:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"renderCanvas"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> engine = <span class="keyword">new</span> BABYLON.Engine(canvas, <span class="literal">true</span>);</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">First we get reference to `</span>canvas<span class="string">` element. Second line creates instance of Babylon engine.</span></span><br><span class="line"><span class="string">We pass `</span><span class="literal">true</span><span class="string">` as second parameter, which will simply add anti-aliasing to prevent rough pixelated edges.</span></span><br><span class="line"><span class="string">Next couple of lines will setup scene. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">createScene</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scene = <span class="keyword">new</span> BABYLON.Scene(engine);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> camera = <span class="keyword">new</span> BABYLON.TargetCamera(<span class="string">'camera'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">5</span>, <span class="number">-10</span>), scene);</span><br><span class="line">        camera.setTarget(BABYLON.Vector3.Zero());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> light = <span class="keyword">new</span> BABYLON.DirectionalLight(<span class="string">'light1'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>), scene);</span><br><span class="line">        light.position = <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sphere = BABYLON.MeshBuilder.CreateSphere(<span class="string">'sphere'</span>, &#123; <span class="attr">segments</span>: <span class="number">16</span>, <span class="attr">diameter</span>: <span class="number">2</span> &#125;, scene);</span><br><span class="line"></span><br><span class="line">        sphere.position.y = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> ground = BABYLON.MeshBuilder.CreateGround(<span class="string">'ground1'</span>, &#123; <span class="attr">height</span>: <span class="number">6</span>, <span class="attr">width</span>: <span class="number">6</span>, <span class="attr">subdivisions</span>: <span class="number">2</span> &#125;, scene);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scene;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> scene = createScene();</span><br></pre></td></tr></table></figure>
<p>First scene instance is created and then objects to populate the scene. That is captured within <code>createScene</code> function.<br><code>var scene = new BABYLON.Scene(engine);</code> is self explanatory, it creates instance of scene.</p>
<p>On next line we create our camera. Now I haven’t mentiond coordinate system in BabylonJS. It is using left handed coordinate system, meaning that positive X goes to right, postive Y goes up and positive Z goes forwards. It’s same as right handed coordinate system, except that Z is reversed ( positive Z goes back in right handed system). Essentialy  scene looks something like this:</p>
<!-- ![alt text](/images/coordinates.png "BabylonJS coordinate system") -->
<p><img src="/images/coordinates.png" style="width:50%"></p>
<p>Camera is pulled back and up to position (0,5,-10), plane is created at position (0,0,0) and sphere at position (0,1,0). Line <code>camera.setTarget(BABYLON.Vector3.Zero());</code> tells to camera in which direction to look at.<br>If it’s still not clear try playing with vectors and values for setting up positions.</p>
<p>As for light, it is set to directional light, which is emitted from everywhere in specified direction and has infinite range. Position is set to 10 on Y axis in order to be above our objects.</p>
<p>Next step is just adding update/render loop and screen resize event.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">   engine.runRenderLoop(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        scene.render();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        engine.resize();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>Render loop is just drawing loop, we could get away without it, since we do not have any movement involved, but I was thinking about maybe adding some moving clouds in part 3, so let’s leave it for now.</p>
<p>For creating our terrain though, first we’re going to need to get familiar with vertices and faces. Terrain specific algorithm will be in part 2 of this post,regardless, some knowledge of faces and creating custom mesh should help to make it easier in long run.</p>
<p><strong>What is a face in computer graphics ?</strong> Well we know that model is made out of triangles and that triangle is a face, consiting of 3 vertexes. Vertex is nothing but a simple point in space. If you didn’t know by know, now you do. Every model is made out of triangles, be it a sphere, plane or some hero in your favorite game. Even in 2d games, sprites are nothing but a textures attached to quad made out of two triangles.  </p>
<p>Next phase is simply passing vertexes to gpu, gpu then connects those vertexes in pipeline phase called <em>triangle assembly</em>, which is represented by this awesome image below.</p>
<!-- ![alt text](/images/triangle.png "Face or render polygon") -->
<p><img src="/images/triangle.png" style="width=50%"></p>
<p>Now with that, let’s actually create triangle out of vertexes.</p>
<p>Start by deleting code for sphere and ground. Then add code for custom mesh and vertexes. Custom in this context means, that we are going to provide vertexes for look of the final model.</p>
<p>Position and direction of light needs to be changed as well, so that light goes directly to triangle. Camera position is changed to be closer to triangle. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">createScene</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scene = <span class="keyword">new</span> BABYLON.Scene(engine);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// change camera position</span></span><br><span class="line">        <span class="keyword">var</span> camera = <span class="keyword">new</span> BABYLON.TargetCamera(<span class="string">'camera'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-5</span>), scene);</span><br><span class="line">        camera.setTarget(BABYLON.Vector3.Zero());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Change position and direction of light</span></span><br><span class="line">        <span class="keyword">var</span> light = <span class="keyword">new</span> BABYLON.DirectionalLight(<span class="string">'light1'</span>, <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>), scene);</span><br><span class="line">        light.position = <span class="keyword">new</span> BABYLON.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> customMesh = <span class="keyword">new</span> BABYLON.Mesh(<span class="string">"custom"</span>, scene);</span><br><span class="line">        <span class="keyword">var</span> material = <span class="keyword">new</span> BABYLON.StandardMaterial(<span class="string">"myMaterial"</span>, scene);</span><br><span class="line">        material.specularColor = <span class="keyword">new</span> BABYLON.Color3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        customMesh.material = material;</span><br><span class="line">        <span class="keyword">var</span> vertexData = <span class="keyword">new</span> BABYLON.VertexData();</span><br><span class="line">        vertexData.positions = [</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">// A</span></span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// B</span></span><br><span class="line">            <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>  <span class="comment">// C</span></span><br><span class="line">        ];</span><br><span class="line">        vertexData.indices = [</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">        ];</span><br><span class="line">        vertexData.colors = [</span><br><span class="line">            <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Red</span></span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Green</span></span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>  <span class="comment">// Blue</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        vertexData.normals = [];</span><br><span class="line">        BABYLON.VertexData.ComputeNormals(vertexData.positions, vertexData.indices, vertexData.normals);</span><br><span class="line"></span><br><span class="line">        vertexData.applyToMesh(customMesh);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scene;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>There is quite a lot here, try running example as something like this should be shown: </p>
<!-- ![alt text](/images/triangle_final.png "Face or render polygon") -->
<p><img src="/images/triangle_final.png" style="width:50%"></p>
<p>Let’s break it up a bit<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customMesh = <span class="keyword">new</span> BABYLON.Mesh(<span class="string">"custom"</span>, scene);</span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> BABYLON.StandardMaterial(<span class="string">"myMaterial"</span>, scene);</span><br><span class="line">material.specularColor = <span class="keyword">new</span> BABYLON.Color3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">customMesh.material = material;</span><br></pre></td></tr></table></figure></p>
<p>This is simple, we define custom <a href="https://en.wikipedia.org/wiki/Polygon_mesh" target="_blank" rel="noopener">mesh</a>, which is simply representation of our data and then assign <a href="https://en.wikipedia.org/wiki/Materials_system" target="_blank" rel="noopener">material</a> to it. <a href="https://en.wikipedia.org/wiki/Specular_highlight" target="_blank" rel="noopener">Specular color</a> which gives object shininess is set to black color, meaning object is not going to emit any shine. I do not want shininess for this example, since it might make our custom triangle look bit weird. We might add bit shininess for our terrain, although not much, it would be bit weird to see real life grass or ground emit shininess like it is glass or some metal object. </p>
<p>Next few lines are interesting<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertexData = <span class="keyword">new</span> BABYLON.VertexData();</span><br><span class="line">vertexData.positions = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">// A</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// B</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>  <span class="comment">// C</span></span><br><span class="line">];</span><br><span class="line">vertexData.indices = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">];</span><br><span class="line">vertexData.colors = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Red</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Green</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>  <span class="comment">// Blue</span></span><br><span class="line">]  </span><br><span class="line">vertexData.normals = [];</span><br><span class="line">BABYLON.VertexData.ComputeNormals(vertexData.positions  vertexData.indices, vertexData.normals)  </span><br><span class="line">vertexData.applyToMesh(customMesh);</span><br></pre></td></tr></table></figure></p>
<p>First we create <code>VertexData</code> instance. This is simply object that will hold all data needed for rendering our object.<br>Next we set vertices positions for triangle. <em>Positions</em> is defined as array and since we are in 3d space, each vertex is going to need x,y,z compomenents. First 3 numbers in positions array represent one vertex with x,y,z components, next 3 numbers second vertex etc…</p>
<p>Incides are indexes for refrencing our vertex. First index in indices array is 0 and it points to first 3 elements in positions array. Meaning 0 from indices -&gt; 0,1,0 in positions, 1 from indices -&gt; 0,0,0 in positions etc…</p>
<p>Why use it? Well in WebGL we could do without indices, but there is reason why should it be used. Let’s say that we want to create simple quad. For that we need 2 triangles. Without indexes it would look something like this.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT ADD THIS</span></span><br><span class="line"><span class="keyword">var</span> positions = [</span><br><span class="line">    <span class="comment">// First triangle</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">// A</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// B</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// C</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Second triangle</span></span><br><span class="line">     <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// C</span></span><br><span class="line">     <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">// D</span></span><br><span class="line">     <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>  <span class="comment">// A</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>As you can see <em>A</em> and <em>C</em> points are duplicated. With indices it will look something like this.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT ADD THIS</span></span><br><span class="line"><span class="keyword">var</span> positions = [</span><br><span class="line">    <span class="comment">// Quad</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">// A</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// B</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// C</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span> <span class="comment">// D</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// DO NOT ADD THIS</span></span><br><span class="line"><span class="keyword">var</span> indices = [</span><br><span class="line">    <span class="comment">// First triangle</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// Second triangle</span></span><br><span class="line">    <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>As you can see vertices are unique and referenced by indices, instead of actually creating dupe vertex in positions array. <em>Why is this important ?</em> Because of model size, most models nowadays have thousands of polygons and when drawing only with vertices, size of model becomes huge due to duplicated vertexes. </p>
<p>Going back to first example with colors:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vertexData.colors = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Red</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// Green</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>  <span class="comment">// Blue</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>Here I have defined color for each vertex of a triangle. Each color has 4 channels: red, green, blue and alpha(transparency). The way the vertex colors work in computer graphics is rather simple. Colors are lineary interpolated between points, meaning color moves from one to other color. For example moving from blue vertex towards red vertex, color will simply be interpolated from blue to red.</p>
<p>Next few lines are bit tricky<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vertexData.normals = [];</span><br><span class="line">BABYLON.VertexData.ComputeNormals(vertexData.positions  vertexData.indices, vertexData.normals)  </span><br><span class="line">vertexData.applyToMesh(customMesh);</span><br></pre></td></tr></table></figure></p>
<p><em>First what are normals and what are they doing?</em> Well normal in computer graphics is vector perpendicular to a face. BabylonJS has a handy <code>ComputeNormals</code> function to get normals from our positions. Why do we use <a href="http://mathworld.wolfram.com/NormalVector.html" target="_blank" rel="noopener">normals</a> ? Simply put for lighting, among other things. We need to know where surface is pointing to in order to correctly cast light on it and that is represented with normals.</p>
<p>It looks something like this, with normal being perpendicular vector.<br><img src="/images/normal.png" style="width:50%"></p>
<p>Finally let’s create function that we’re going to use to create terrain faces. Add it just below <code>createScene</code> function.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createScene</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFace</span>(<span class="params">topLeft, bottomLeft, bottomRight, topRight, i, color</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> v1 = topLeft;</span><br><span class="line">    <span class="keyword">var</span> v2 = bottomLeft;</span><br><span class="line">    <span class="keyword">var</span> v3 = bottomRight;</span><br><span class="line">    <span class="keyword">var</span> v4 = topRight;</span><br><span class="line">    <span class="comment">// first triangle </span></span><br><span class="line">    <span class="keyword">var</span> triangle1 = [i, i+<span class="number">1</span>, i+<span class="number">2</span>];</span><br><span class="line">    <span class="comment">// second triangle</span></span><br><span class="line">    <span class="keyword">var</span> triangle2 = [i+<span class="number">2</span>, i+<span class="number">3</span>, i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        positions: v1.concat(v2, v3, v4),</span><br><span class="line">        indices: triangle1.concat(triangle2),</span><br><span class="line">        colors: color.concat(color, color, color),</span><br><span class="line">        i: i + <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>createFace</code> is simply a function to create, well a face. First we create 4 vertices, then indices to reference those vertices and finally add some colors.<br>We return all the data needed for vertex buffer and indices index <code>i</code>. <code>concat</code> function call is used to put everything into one dimensional array.</p>
<p>Now let’s simply call <code>createFace</code> function inside <code>createScene</code> function, right after vertex data instance.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> vertexData = <span class="keyword">new</span> BABYLON.VertexData();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> face = createFace([<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>], [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>], [<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>], [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>], index, [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]);;</span><br><span class="line">vertexData.positions = face.positions;</span><br><span class="line">vertexData.indices = face.indices;</span><br><span class="line">vertexData.colors = face.colors;</span><br><span class="line">vertexData.normals = [];</span><br><span class="line">BABYLON.VertexData.ComputeNormals(vertexData.positions, vertexData.indices, vertexData.normals);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>After this try to refresh browser or run app and green quad should be shown.<br><img src="/images/final_part1.png" style="width:25%;"></p>
<p>This should set us up for upcoming <a href="/2018/06/24/Low-Poly-Terrain-Part-2-Terrain-Generation">part 2</a>.</p>
<p>Also code examples for this post are available at <a href="https://github.com/luka712/BabylonJS---Terrain-Generation/tree/master/Part%201" target="_blank" rel="noopener">Github</a>.)</p>
</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.2.0/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="/scripts/index.js" type="text/javascript"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-121717766-1');ga('send','pageview');</script></body></html>