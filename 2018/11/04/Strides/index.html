<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>WebGL interleaved arrays data | luka712 blog</title><meta name="description" content="Find out how to interleave vertex array data and use it with WebGl."><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/About" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">WebGL interleaved arrays data</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-11-04T09:03:27.000Z"> Sunday, November 4th 2018 at 10:03</time><br>Last updated on<time itemprop="dateModified" datetime="2018-11-04T09:03:27.000Z"> Monday, November 5th 2018 at 21:05</time></span><h5 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h5><p>First, I want to mention, that I expect some knowledge of 3d rendering API’s like OpenGL, DirectX and similar before reading this post, otherwise I don’t think that you’re going to get much out of it.</p>
<p>Either way, I’m using WebGL for this examples, but it can be used easily with any other OpenGL implementations.</p>
<p>So what are interleaved arrays ? Simply put it’s way of organising data. Usually for displaying simple model we need to have positions, texture coordinates and normal vertex data, and all of those could be stored in seperate buffers, which means more buffers with less data or a single buffer with more data.</p>
<h6 id="Arrays-Strategy"><a href="#Arrays-Strategy" class="headerlink" title="Arrays Strategy"></a>Arrays Strategy</h6><ul>
<li>store each type of vertices array data in seperate buffer</li>
<li>store all vertices array data in single buffer. Also known as interleaving</li>
</ul>
<p>When I usually look at examples, most of them are using seperate buffers, which truth to be told, seems easier to implement and I personally find it more readeable. But interleaving data and storing it in single buffer has it’s performance advantages. </p>
<p>Also assigning lot of tiny buffers can cause driver problems. Info about best practices can be found on <a href="https://www.khronos.org/opengl/wiki/Vertex_Specification_Best_Practices" target="_blank" rel="noopener">khronos page</a>.</p>
<p>So how does that actually look like ?</p>
<ul>
<li>Using multiple Arrays</li>
</ul>
<p><img src="/images/10/image1.png" style="width:50%"></p>
<ul>
<li>Using single array</li>
</ul>
<p><img src="/images/10/image2.png" style="width:50%"></p>
<p>You can already notice that data with single array buffer needs to be organized in specific way. We can’t just randomly fill in array and expect it to work. More about that later.</p>
<h5 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h5><p>I have already prepared example with html and javascript, so feel free just to copy/paste it or clone it from <a href="https://github.com/luka712/WebGL_Interleaved_Data" target="_blank" rel="noopener">repository</a>.</p>
<ul>
<li>Index.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"script.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"x-shader/x-vertex"</span> <span class="attr">id</span>=<span class="string">"vertex-shader"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        attribute vec4 a_position;</span></span><br><span class="line"><span class="undefined">        attribute vec4 a_color;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        varying vec4 v_color;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">void</span> main()</span></span><br><span class="line"><span class="undefined">        &#123;</span></span><br><span class="line"><span class="undefined">            v_color = a_color;</span></span><br><span class="line"><span class="undefined">            gl_Position = a_position;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"x-shader/x-fragment"</span> <span class="attr">id</span>=<span class="string">"fragment-shader"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        precision mediump float;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        varying vec4 v_color;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">void</span> main()</span></span><br><span class="line"><span class="undefined">        &#123;</span></span><br><span class="line"><span class="undefined">            gl_FragColor = v_color;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"render-canvas"</span> <span class="attr">width</span>=<span class="string">"800"</span> <span class="attr">height</span>=<span class="string">"600"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Script.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> indices = [</span><br><span class="line">        <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> positionAttributeLocation = <span class="literal">null</span>,</span><br><span class="line">        colorAttributeLocation = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"render-canvas"</span>),</span><br><span class="line">        gl = canvas.getContext(<span class="string">'webgl'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> vertexShader = compileShader(gl.VERTEX_SHADER, <span class="string">"vertex-shader"</span>),</span><br><span class="line">        fragmentShader = compileShader(gl.FRAGMENT_SHADER, <span class="string">"fragment-shader"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> program = createProgram(vertexShader, fragmentShader);</span><br><span class="line">    gl.useProgram(program);</span><br><span class="line">    positionAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_position"</span>);</span><br><span class="line">    colorAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_color"</span>);</span><br><span class="line"></span><br><span class="line">    createMultipleBuffersForPositionsAndColors();</span><br><span class="line">    <span class="comment">// createSingleBufferPositionsAndColors();</span></span><br><span class="line"></span><br><span class="line">    createIndexBuffer();</span><br><span class="line"></span><br><span class="line">    gl.enableVertexAttribArray(positionAttributeLocation);</span><br><span class="line">    gl.enableVertexAttribArray(colorAttributeLocation);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    gl.clearColor(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    gl.viewport(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">    draw();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createProgram</span>(<span class="params">gvertexShader, fragmentShader</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> program = gl.createProgram();</span><br><span class="line"></span><br><span class="line">        gl.attachShader(program, vertexShader);</span><br><span class="line">        gl.attachShader(program, fragmentShader);</span><br><span class="line"></span><br><span class="line">        gl.linkProgram(program);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!gl.getProgramParameter(program, gl.LINK_STATUS)) &#123;</span><br><span class="line">            alert(<span class="string">"Unable to link program: "</span> + gl.getProgramInfoLog(program));</span><br><span class="line">            gl.deleteShader(vertexShader);</span><br><span class="line">            gl.deleteShader(fragmentShader);</span><br><span class="line">            gl.deleteProgram(program);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> program;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">compileShader</span>(<span class="params">shaderType, id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> shader = gl.createShader(shaderType),</span><br><span class="line">            shaderSource = <span class="built_in">document</span>.getElementById(id).innerText;</span><br><span class="line"></span><br><span class="line">        gl.shaderSource(shader, shaderSource);</span><br><span class="line">        gl.compileShader(shader);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) &#123;</span><br><span class="line">            alert(<span class="string">"Unable to comple shader: "</span> + gl.getShaderInfoLog(shader));</span><br><span class="line">            gl.deleteShader(shader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createMultipleBuffersForPositionsAndColors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Data for quad positions, positions array.</span></span><br><span class="line">        <span class="keyword">var</span> positions = [</span><br><span class="line">            <span class="comment">// X, Y</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">0.5</span>,   <span class="comment">// first vertex</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">-0.5</span>,  <span class="comment">// second vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">-0.5</span>,   <span class="comment">// third vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">0.5</span>,    <span class="comment">// fourth vertex</span></span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Data for quad colors, colors array.</span></span><br><span class="line">        <span class="keyword">var</span> colors = [</span><br><span class="line">            <span class="comment">// R, G, B, A</span></span><br><span class="line">            <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// first vertex</span></span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// second vertex</span></span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="comment">// third vertex</span></span><br><span class="line">            <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>   <span class="comment">// fourth vertex</span></span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and bind first buffer for position vertex data.</span></span><br><span class="line">        <span class="keyword">var</span> positionBuffer = gl.createBuffer();</span><br><span class="line">        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add data to first buffer.</span></span><br><span class="line">        gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(positions), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe positions data for first buffer.</span></span><br><span class="line">        gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create second buffer of colors vertex data.</span></span><br><span class="line">        <span class="keyword">var</span> colorBuffer = gl.createBuffer();</span><br><span class="line">        gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add data to second buffer.</span></span><br><span class="line">        gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(colors), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe colors data for second buffer.</span></span><br><span class="line">        gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createSingleBufferPositionsAndColors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> positionsAndColors = [</span><br><span class="line">            <span class="comment">// X, Y,    R, G, B, A</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,      <span class="comment">// first vertex</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,     <span class="comment">// second vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,      <span class="comment">// third vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>        <span class="comment">// fourth vertex</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sizes are important to know.</span></span><br><span class="line">        <span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">var</span> numberOfTotalVertexesForQuad = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Need to know final size in floats and bytes, in order to fill arrays.</span></span><br><span class="line">        <span class="keyword">var</span> vertexSizeInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT + colorVertexSize * <span class="built_in">Uint8Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line">        <span class="keyword">var</span> vertexSizeInFloats = vertexSizeInBytes / <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// total array</span></span><br><span class="line">        <span class="keyword">var</span> arrayBuffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(numberOfTotalVertexesForQuad * vertexSizeInBytes);</span><br><span class="line">        <span class="comment">// View for positions.</span></span><br><span class="line">        <span class="keyword">var</span> positionView = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(arrayBuffer);</span><br><span class="line">        <span class="comment">// View for colors.</span></span><br><span class="line">        <span class="keyword">var</span> colorView = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> positionOffsetInFloats = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// offset to skip x and y positions of first vertex.</span></span><br><span class="line">        <span class="keyword">var</span> colorOffsetInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// positionsAndColors index</span></span><br><span class="line">        <span class="keyword">var</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numberOfTotalVertexesForQuad; i++) &#123;</span><br><span class="line">            positionView[positionOffsetInFloats] = positionsAndColors[k];</span><br><span class="line">            positionView[positionOffsetInFloats + <span class="number">1</span>] = positionsAndColors[k + <span class="number">1</span>];</span><br><span class="line">            colorView[colorOffsetInBytes] = positionsAndColors[k + <span class="number">2</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">1</span>] = positionsAndColors[k + <span class="number">3</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">2</span>] = positionsAndColors[k + <span class="number">4</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">3</span>] = positionsAndColors[k + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">            positionOffsetInFloats += vertexSizeInFloats;</span><br><span class="line">            colorOffsetInBytes += vertexSizeInBytes;</span><br><span class="line">            k += <span class="number">6</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and bind single buffer.</span></span><br><span class="line">        <span class="keyword">var</span> posAndColbuffer = gl.createBuffer();</span><br><span class="line">        gl.bindBuffer(gl.ARRAY_BUFFER, posAndColbuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add data to single buffer.</span></span><br><span class="line">        gl.bufferData(gl.ARRAY_BUFFER, arrayBuffer, gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe positions data for buffer. Notice 2 last parameters, first one is stride.</span></span><br><span class="line">        <span class="comment">// Stride is total size of single vertex ( position and color).</span></span><br><span class="line">        <span class="comment">// Second one is offset. Positions start at 0, so don't skip anything.</span></span><br><span class="line">        gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, vertexSizeInBytes, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe color data for buffer. Stride need to be defined just like with previous call.</span></span><br><span class="line">        <span class="comment">// Offset is last argument and it it set to size of positions in Bytes, so that it skips positions and </span></span><br><span class="line">        <span class="comment">// starts lookg at colors.</span></span><br><span class="line">        gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, vertexSizeInBytes, positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createIndexBuffer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> indicesBuffer = gl.createBuffer();</span><br><span class="line">        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indicesBuffer);</span><br><span class="line">        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(indices), gl.STATIC_DRAW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        gl.drawElements(gl.TRIANGLES, <span class="number">6</span>, gl.UNSIGNED_BYTE, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        requestAnimationFrame(draw);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Try to run it and you would get this.</p>
<p><img src="/images/10/image3.png" style="width:50%"></p>
<p>It’s not much but it is good enough to test with. It is just a quad with 4 vertices, each for every edge and 4 colors, also each for every edge.<br>What we’re really interested are two function calls, <em>createMultipleBuffersForPositionsAndColors</em> and <em>createSingleBufferPositionsAndColors</em>.  </p>
<p>Those contain all logic for creating buffers, adding data to them and describing that data.</p>
<h5 id="Multiple-buffers"><a href="#Multiple-buffers" class="headerlink" title="Multiple buffers"></a>Multiple buffers</h5><p>Implementation of function <em>createMultipleBuffersForPositionsAndColors</em> is most likely already familiar to you, it is just setting buffer for each array, in this case position and color array. Let’s break it down just in case.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMultipleBuffersForPositionsAndColors</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// Data for quad positions, positions array.</span></span><br><span class="line">    <span class="keyword">var</span> positions = [</span><br><span class="line">        <span class="comment">// X, Y</span></span><br><span class="line">        <span class="number">-0.5</span>, <span class="number">0.5</span>,    <span class="comment">// first vertex</span></span><br><span class="line">        <span class="number">-0.5</span>, <span class="number">-0.5</span>,   <span class="comment">// second vertex</span></span><br><span class="line">        <span class="number">0.5</span>, <span class="number">-0.5</span>,    <span class="comment">// third vertex</span></span><br><span class="line">        <span class="number">0.5</span>, <span class="number">0.5</span>,     <span class="comment">// fourth vertex</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Data for quad colors, colors array.</span></span><br><span class="line">    <span class="keyword">var</span> colors = [</span><br><span class="line">        <span class="comment">// R, G, B, A</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// first vertex</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// second vertex</span></span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="comment">// third vertex</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>   <span class="comment">// fourth vertex</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create and bind first buffer for position vertex data.</span></span><br><span class="line">    <span class="keyword">var</span> positionBuffer = gl.createBuffer();</span><br><span class="line">    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add data to first buffer.</span></span><br><span class="line">    gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(positions), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Describe positions data for first buffer.</span></span><br><span class="line">    gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create second buffer of colors vertex data.</span></span><br><span class="line">    <span class="keyword">var</span> colorBuffer = gl.createBuffer();</span><br><span class="line">    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add data to second buffer.</span></span><br><span class="line">    gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(colors), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Describe colors data for second buffer.</span></span><br><span class="line">    gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So from this it’s easy to see that two <em>WegGLBuffer</em> objects are created with <em>createBuffer</em> calls. First one for positions and second one for colors. When we look at interleaved data bit later, only one is going to be created. Second important thing is to notice <em>bufferData</em> and <em>vertexAttribPointer</em> calls. Later on we’re going ot have one buffer data call, but still two calls to <em>vertexAttribPointer</em> since data always needs to be described to WebGL. </p>
<p>First part is just creating data.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// Data for quad positions, positions array.</span></span><br><span class="line"><span class="keyword">var</span> positions = [</span><br><span class="line">    <span class="comment">// X, Y</span></span><br><span class="line">    <span class="number">-0.5</span>, <span class="number">0.5</span>,    <span class="comment">// first vertex</span></span><br><span class="line">    <span class="number">-0.5</span>, <span class="number">-0.5</span>,   <span class="comment">// second vertex</span></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">-0.5</span>,    <span class="comment">// third vertex</span></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">0.5</span>,     <span class="comment">// fourth vertex</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data for quad colors, colors array.</span></span><br><span class="line"><span class="keyword">var</span> colors = [</span><br><span class="line">    <span class="comment">// R, G, B, A</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// first vertex</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">// second vertex</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="comment">// third vertex</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>   <span class="comment">// fourth vertex</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>Then create buffer and assign data to it</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and bind first buffer for position vertex data.</span></span><br><span class="line"><span class="keyword">var</span> positionBuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add data to first buffer.</span></span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(positions), gl.STATIC_DRAW);</span><br></pre></td></tr></table></figure>
<p>It is important to know precision and size of data when sending it to  WebGL. In the case for positions, I want to use <em>floating</em> point numbers. <em>Floating</em> point numbers have size of 4 bytes (32 bits, 8 per byte), so <em>Float32Array</em> is used.<br>Same is true for color buffer, it just has different data type of different size.</p>
<p> Now describing data with <em>vertexAttribPointer</em> call.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Describe positions data for first buffer.</span></span><br><span class="line">gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Describe colors data for second buffer.</span></span><br><span class="line">gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>You might notice that first paramter in <em>vertexAttribPointer</em> call is <em>positionAttributeLocation</em> which is address of <em>a_position</em> in shader as already mentioned.</p>
<p>Just to note, calls to get attribute locations are defined earlier in code, <em>positionAttributeLocation</em> is address of <em>a_position</em> attribute in vertex shader, <em>colorAttributeLocation</em> is address of <em>a_color</em> attribute in vertex shader. This is how we link shader attribute variables with JavaScript code. We need to know location, where to send data to.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Somewhere earlier in code </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These are called before create buffer functions.</span></span><br><span class="line">positionAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_position"</span>);</span><br><span class="line">colorAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_color"</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Shader code</span></span><br><span class="line"><span class="keyword">attribute</span> <span class="type">vec4</span> a_position;</span><br><span class="line"><span class="keyword">attribute</span> <span class="type">vec4</span> a_color;</span><br></pre></td></tr></table></figure>
<p>Looking back at <em>vertexAttribPointer</em> note that second parameter is <em>positionVertexSize</em> which has value of 2 (XY coordinates) for position call. For colors we’re using <em>colorVertexSize</em> which is set to 4 (Red Green Blue Alpha values).</p>
<p>Third parameters as already mentioned, is telling WebGL size and type of data. In this case <em>FLOAT</em> number type for positions and <em>UNSIGNED_BYTE</em> for colors.</p>
<p>Fourth parameter is normalize parameter, we don’t need this, but this would be usefull if we defined colors like bytes, for example 255 instead of 1, so this would normalize 255 to be 1. Let’s skip fifth and sixth paramter for now, since those are mentioned later and not needed now.</p>
<p>Which bring us to next part.</p>
<h5 id="Interleaved-data"><a href="#Interleaved-data" class="headerlink" title="Interleaved data"></a>Interleaved data</h5><p>For second example, change line </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">createMultipleBuffersForPositionsAndColors();</span><br><span class="line"><span class="comment">// createSingleBufferPositionsAndColors();</span></span><br></pre></td></tr></table></figure>
<p>to</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createMultipleBuffersForPositionsAndColors();</span></span><br><span class="line">createSingleBufferPositionsAndColors();</span><br></pre></td></tr></table></figure>
<p>if you are following code example. </p>
<p>Function <em>createSingleBufferPositionsAndColors</em> is using only one set of data and a single buffer for data, which is main difference between the two.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSingleBufferPositionsAndColors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> positionsAndColors = [</span><br><span class="line">            <span class="comment">// X, Y,    R, G, B, A</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,      <span class="comment">// first vertex</span></span><br><span class="line">            <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,     <span class="comment">// second vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,      <span class="comment">// third vertex</span></span><br><span class="line">            <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>        <span class="comment">// fourth vertex</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sizes are important to know.</span></span><br><span class="line">        <span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">var</span> numberOfTotalVertexesForQuad = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> vertexSizeInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT + colorVertexSize * <span class="built_in">Uint8Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line">        <span class="keyword">var</span> vertexSizeInFloats = vertexSizeInBytes / <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// total array</span></span><br><span class="line">        <span class="keyword">var</span> arrayBuffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(numberOfTotalVertexesForQuad * vertexSizeInBytes);</span><br><span class="line">        <span class="comment">// View for positions.</span></span><br><span class="line">        <span class="keyword">var</span> positionView = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(arrayBuffer);</span><br><span class="line">        <span class="comment">// View for colors.</span></span><br><span class="line">        <span class="keyword">var</span> colorView = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> positionOffsetInFloats = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// offset to skip x and y positions of first vertex.</span></span><br><span class="line">        <span class="keyword">var</span> colorOffsetInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// positionsAndColors index</span></span><br><span class="line">        <span class="keyword">var</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numberOfTotalVertexesForQuad; i++) &#123;</span><br><span class="line">            positionView[positionOffsetInFloats] = positionsAndColors[k];</span><br><span class="line">            positionView[positionOffsetInFloats + <span class="number">1</span>] = positionsAndColors[k + <span class="number">1</span>];</span><br><span class="line">            colorView[colorOffsetInBytes] = positionsAndColors[k + <span class="number">2</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">1</span>] = positionsAndColors[k + <span class="number">3</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">2</span>] = positionsAndColors[k + <span class="number">4</span>];</span><br><span class="line">            colorView[colorOffsetInBytes + <span class="number">3</span>] = positionsAndColors[k + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">            positionOffsetInFloats += vertexSizeInFloats;</span><br><span class="line">            colorOffsetInBytes += vertexSizeInBytes;</span><br><span class="line">            k += <span class="number">6</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and bind single buffer.</span></span><br><span class="line">        <span class="keyword">var</span> posAndColbuffer = gl.createBuffer();</span><br><span class="line">        gl.bindBuffer(gl.ARRAY_BUFFER, posAndColbuffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add data to single buffer.</span></span><br><span class="line">        gl.bufferData(gl.ARRAY_BUFFER, arrayBuffer, gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe positions data for buffer. Notice 2 last parameters, first one is stride.</span></span><br><span class="line">        <span class="comment">// Stride is total size of single vertex ( position and color).</span></span><br><span class="line">        <span class="comment">// Second one is offset. Positions start at 0, so don't skip anything.</span></span><br><span class="line">        gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, vertexSizeInBytes, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Describe color data for buffer. Stride need to be defined just like with previous call.</span></span><br><span class="line">        <span class="comment">// Offset is last argument and it it set to size of positions in Bytes, so that it skips positions and </span></span><br><span class="line">        <span class="comment">// starts looking at colors.</span></span><br><span class="line">        gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, vertexSizeInBytes, positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>As you can already see, that’s quite a mess of code. The reason for that is that we’re having two different types of data that need to be in single array (floating points for positions and bytes for colors).</p>
<p>But let’s actually start with code.<br>First difference is in the data, previously we used two arrays, now all data is in single array.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> positionsAndColors = [</span><br><span class="line">    <span class="comment">// X, Y,    R, G, B, A</span></span><br><span class="line">    <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,      <span class="comment">// first vertex</span></span><br><span class="line">    <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,     <span class="comment">// second vertex</span></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,      <span class="comment">// third vertex</span></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>        <span class="comment">// fourth vertex</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sizes are important to know.</span></span><br><span class="line"><span class="keyword">var</span> positionVertexSize = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> colorVertexSize = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">var</span> numberOfTotalVertexesForQuad = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>Regardless of it being in one array, we still need to describe the data to WebGL later, so array needs to be sorted correctly. There is one call to create and bind buffer, but multiple calls to <em>vertexAttribPointer</em> to describe data to WebGL.</p>
<p>Next set total sizes to be used for array buffer.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vertexSizeInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT + colorVertexSize * <span class="built_in">Uint8Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"><span class="keyword">var</span> vertexSizeInFloats = vertexSizeInBytes / <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br></pre></td></tr></table></figure>
<p>This code is just setting size of total vertex buffer in bytes and floats. We’re going to need it to fill array buffer and as a size of <strong>stride</strong>. <strong>Stride</strong> is just size of vertex data set in bytes and is actually fifth parameter of <em>vertexAttribPointer</em> function, but more about that later.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lookat it like this </span></span><br><span class="line"><span class="comment">// X,  Y,        R, G, B, A</span></span><br><span class="line"><span class="number">-0.5</span>,  <span class="number">0.5</span>,      <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,     <span class="comment">// first vertex or stride.</span></span><br><span class="line"><span class="number">-0.5</span>, <span class="number">-0.5</span>,      <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,     <span class="comment">// second vertex</span></span><br><span class="line"> <span class="number">0.5</span>, <span class="number">-0.5</span>,      <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,     <span class="comment">// third vertex</span></span><br><span class="line"> <span class="number">0.5</span>,  <span class="number">0.5</span>,      <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>      <span class="comment">// fourth vertex</span></span><br></pre></td></tr></table></figure>
<p>Now to fill all data we really need to get hang of typed arrays, which are bit weird to work with, especially for those who actually never used them or worked with some lower level language. Usually we don’t have to worry about number sizes in JavaScript, but when it comes to WebGL it does mater.</p>
<p>There is more on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays" target="_blank" rel="noopener">typed array here</a>, but long story short, it’s just an object to manipulate with raw binary data. </p>
<p>Next lines create array buffer.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// total array</span></span><br><span class="line"><span class="keyword">var</span> arrayBuffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(numberOfTotalVertexesForQuad * vertexSizeInBytes);</span><br><span class="line"><span class="comment">// View for positions.</span></span><br><span class="line"><span class="keyword">var</span> positionView = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(arrayBuffer);</span><br><span class="line"><span class="comment">// View for colors.</span></span><br><span class="line"><span class="keyword">var</span> colorView = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span><br></pre></td></tr></table></figure>
<p>And actually two array views for array buffer, which are pretty much that, views into <em>ArrayBuffer</em> object, used to manipulate with different numeric formats. </p>
<p>Next couple of lines just fill up the <em>arrayBuffer</em> with data, through views. Notice offset in next couple of lines.<br>Aside from having multiple views for data, data also needs be offset correctly since everything goes into <em>arrayBuffer</em> object. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> positionOffsetInFloats = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// offset to skip x and y positions of first vertex.</span></span><br><span class="line"><span class="keyword">var</span> colorOffsetInBytes = positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT;</span><br><span class="line"><span class="comment">// positionsAndColors index</span></span><br><span class="line"><span class="keyword">var</span> k = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numberOfTotalVertexesForQuad; i++) &#123;</span><br><span class="line">    positionView[positionOffsetInFloats] = positionsAndColors[k];</span><br><span class="line">    positionView[positionOffsetInFloats + <span class="number">1</span>] = positionsAndColors[k + <span class="number">1</span>];</span><br><span class="line">    colorView[colorOffsetInBytes] = positionsAndColors[k + <span class="number">2</span>];</span><br><span class="line">    colorView[colorOffsetInBytes + <span class="number">1</span>] = positionsAndColors[k + <span class="number">3</span>];</span><br><span class="line">    colorView[colorOffsetInBytes + <span class="number">2</span>] = positionsAndColors[k + <span class="number">4</span>];</span><br><span class="line">    colorView[colorOffsetInBytes + <span class="number">3</span>] = positionsAndColors[k + <span class="number">5</span>];</span><br><span class="line">    positionOffsetInFloats += vertexSizeInFloats;</span><br><span class="line">    colorOffsetInBytes += vertexSizeInBytes;</span><br><span class="line">    k += <span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Buffer calls: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and bind single buffer.</span></span><br><span class="line"><span class="keyword">var</span> posAndColbuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, posAndColbuffer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add data to single buffer.</span></span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, arrayBuffer, gl.STATIC_DRAW);</span><br></pre></td></tr></table></figure>
<p>Nothing new here, except for passing <em>arrayBuffer</em> argument, which now holds data for positions and colors.</p>
<p>Notice that there are still two calls to <em>vertexAttribPointer</em>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Describe positions data for buffer. Notice 2 last parameters, first one is stride.</span></span><br><span class="line"><span class="comment">// Stride is total size of single vertex ( position and color).</span></span><br><span class="line"><span class="comment">// Second one is offset. Positions start at 0, so don't skip anything.</span></span><br><span class="line">gl.vertexAttribPointer(positionAttributeLocation, positionVertexSize, gl.FLOAT, <span class="literal">false</span>, vertexSizeInBytes, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// Describe color data for buffer. Stride need to be defined just like with previous call.</span></span><br><span class="line"><span class="comment">// Offset is last argument and it it set to size of positions in Bytes, so that it skips positions and </span></span><br><span class="line"><span class="comment">// starts lookg at colors.</span></span><br><span class="line">gl.vertexAttribPointer(colorAttributeLocation, colorVertexSize, gl.UNSIGNED_BYTE, <span class="literal">false</span>, vertexSizeInBytespositionVertexSize , positionVertexSize * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span><br></pre></td></tr></table></figure>
<p>First <em>vertexAttribPointer</em> describes data for positions. First 4 arguments have already been mentioned earlied, but fifth argument was not. This is <strong>stride</strong> argument, and we pass <em>vertexSizeInBytes</em> which is telling WebGL size of single vertex for attributes ( position and color combined).</p>
<p>This needs to be set to correct size. If not, well all kind of things could go wrong, so prepare for some debugging sessions, as it’s not always quite obvious where the error is.</p>
<p> Second argument is offset, we do not need it for position, since positions start from 0 index, but for second call to <em>vertexAttribPointer</em> it is defined. This is just telling WebGL to skip first 8 bytes, 4 bytes for position X and 4 bytes for position Y and this places it to position of color in our buffer.</p>
<p>And that is how to do interleaved data in WebGL. Personally, I’m not fan of it, still it’s good to be aware of it. It is an option, if performance is absolutely necessary, although I prefer readability and simplicity of multiple buffers. Either way, point of post was just to bring some attention to it, not to compare the two.</p>
</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.3.0-alpha.12/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="https://cdn.jsdelivr.net/npm/babylonjs-gui@3.3.0/babylon.gui.min.js"></script><script src="/scripts/index.js" type="text/javascript"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-121717766-1');ga('send','pageview');</script></body></html>