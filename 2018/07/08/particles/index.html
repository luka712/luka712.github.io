<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Canvas particles | luka712 blog</title><meta name="description" content="One of the thing that I really like is playing with something that moves, especially if you can make it on web page, which makes it even better, since it can be shown to just about anyone. So in this post, I've decided to do just that. Add some moving particles with canvas element."><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/About" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Canvas particles</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-07-08T07:03:07.000Z"> Sunday, July 8th 2018 at 9:03</time><br>Last updated on<time itemprop="dateModified" datetime="2018-07-08T07:03:07.000Z"> Saturday, July 28th 2018 at 22:18</time></span><h5 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h5><p>First I would like to mention what we’re going to create. I’m not aiming for full library as <a href="https://vincentgarreau.com/particles.js/" target="_blank" rel="noopener">particles</a>. That would take days probably.<br>But I do recommend it or any other similar project, it’s amazing what can be done with couple of lines of code with such projects.</p>
<p>For this post though, aim is to learn canvas and particles programming, so I’m going to focus on hexagons with some lines between them. Of course size and color are going to be animated. And, while we’re at it, we’re going to add some movement away from mouse.</p>
<p>This more excatly.</p>

<canvas id="html-canvas-particles" style="width:100%" onload="loadHtmlCanvasParticles()"></canvas>
<script>

loadHtmlCanvasParticles();
function loadHtmlCanvasParticles() {

      function HexagonParticle(position, sizeMin, sizeMax, direction, color, alpha) {

  this.position = position || new Vector(0, 0);
  this.sizeMin = sizeMin || 1;
  this.sizeMax = sizeMax || 1;
  this.scale = 1;
  this.direction = direction || new Vector(0, 0);
  this.color = color || 'rgb(	49, 140, 231)';
  this.alphaChangeRate = Math.random();
  this.scaleChangeRate = Math.random() * 2;
  this.alpha = 0;
  this.radius = 100;

  this.points = [5, 0,
    2.5, -4.33,
    -2.5, -4.33,
    -5, 0,
    -2.5, 4.33,
    2.5, 4.33,
    5, 0];

}

HexagonParticle.prototype = {
  update: function (ctx, time) {
    this.scale = this.sizeMin + ((this.sizeMax - this.sizeMin) / 2) + Math.cos(time * this.scaleChangeRate) * ((this.sizeMax - this.sizeMin) / 2);
    this.alpha = 0.5 + Math.cos(time * this.alphaChangeRate) * 0.5;
    ctx.globalAlpha = this.alpha;
    ctx.beginPath();
    this.position.addTo(this.direction);
    var posX = this.points[0] * this.scale + this.position.x;
    var posY = this.points[1] * this.scale + this.position.y;
    ctx.moveTo(posX, posY);
    for (var i = 2; i < this.points.length; i += 2) {
      posX = this.points[i] * this.scale + this.position.x;
      posY = this.points[i + 1] * this.scale + this.position.y;
      ctx.lineTo(posX, posY);
    }
    ctx.fillStyle = this.color;
    ctx.fill();
    ctx.closePath();
  }
}

function Vector(x, y) {
  this.x = x;
  this.y = y;
}

Vector.prototype = {
  addTo: function (vector) {
    this.x += vector.x;
    this.y += vector.y;
  },
  multiplyBy: function (scalar) {
    this.x *= scalar;
    this.y *= scalar;
  },
  diff: function (vector) {
    return new Vector(this.x - vector.x, this.y - vector.y);
  },
  distance: function (vector) {
    var dx = this.x - vector.x;
    var dy = this.y - vector.y;
    return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
  },
  getLength: function () {
    return Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2));
  },
  setLength: function (newLength) {
    this.multiplyBy(newLength / this.getLength());
  },
  normalize: function () {
    var length = this.getLength();
    this.x /= length;
    this.y /= length;
  }
}


  var time = 0.00;

  var canvas = document.getElementById("html-canvas-particles");
  var ctx = canvas.getContext('2d');
  var width = canvas.offsetWidth;
  var height = canvas.offsetHeight;
    canvas.width = width;
    canvas.height = height;
  var particles = [];
  for (var i = 0; i < 100; i++) {
    particles.push(new HexagonParticle(
      new Vector(Math.random() * canvas.width, Math.random() * canvas.height),
      1, 3,
      new Vector(Math.random() * 0.5 - 0.25, Math.random() * 0.5 - 0.25)));
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (var i = 0; i < particles.length; i++) {
      particles[i].update(ctx, time);
      if (particles[i].position.x <= 0 || particles[i].position.x >= canvas.width
        || particles[i].position.y <= 0 || particles[i].position.y >= canvas.height) {
        particles[i].direction.multiplyBy(-1);
      }

      for (var j = i + 1; j < particles.length; j++) {
        var distance = particles[i].position.distance(particles[j].position);
        var radiusSum = particles[i].radius + particles[j].radius;
        if (distance < radiusSum) {
          ctx.globalAlpha = 1 - distance / radiusSum;
          ctx.beginPath();
          ctx.moveTo(particles[i].position.x, particles[i].position.y);
          ctx.lineTo(particles[j].position.x, particles[j].position.y);
          ctx.strokeStyle = 'rgb(49, 140, 231)';
          ctx.stroke();
          ctx.closePath();
        }
      }
    }

    time += 0.01;
    requestAnimationFrame(render);
  }
  render();


  canvas.addEventListener("mousemove", function (e) {
    var repulseDistance = 100;
    var me = document.getElementsByTagName('main')[0];
    var scroll = { x: me.scrollLeft, y: me.scrollTop };
    var mousePos = new Vector(e.x - this.offsetLeft + scroll.x, e.y - this.offsetTop + scroll.y);
    for (var i = 0; i < particles.length; i++) {
      var distance = particles[i].position.distance(mousePos);
      if (distance < repulseDistance) {
        var dir = particles[i].position.diff(mousePos);
        dir.normalize();
        dir.setLength(repulseDistance - distance);
        particles[i].position.addTo(dir);
      }
    }
  });



}


</script>


<p>This is done using html canvas element, therefore it runs in browser.<br>Add to files need for this tutorial.<br>I called mine <em>index.html</em> and <em>main.js</em>.</p>
<p>In html file add following</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        canvas &#123;</span></span><br><span class="line"><span class="undefined">            width: 100%;</span></span><br><span class="line"><span class="undefined">            position: absolute;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span> <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>All it has is <em>canvas</em> elements with some <em>css</em> added. Notice <em>id</em> attribute on <em>canvas</em> element.</p>
<p>To <em>main.js</em> add lines</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">        width = <span class="built_in">window</span>.innerWidth,</span><br><span class="line">        height = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"></span><br><span class="line">    canvas.width = width;</span><br><span class="line">    canvas.height = height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    context.rect(<span class="number">20</span>,<span class="number">20</span>,<span class="number">150</span>,<span class="number">100</span>);</span><br><span class="line">    context.stroke(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you try to run this in browser, there should be rectangle drawn.<br>About code, first we get canvas and sets it’s width and height to browser inner window width and height.<br>That is saying to canvas element to use all available space.<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener">Canvas context</a> is simply an interface for drawing on html canvas and we get it by calling <em>2d</em> canvas context.</p>
<p>Lines<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context.rect(<span class="number">20</span>,<span class="number">20</span>,<span class="number">150</span>,<span class="number">100</span>);</span><br><span class="line">context.stroke();</span><br></pre></td></tr></table></figure></p>
<p>will simply draw a rectangle and add some stroke to it. Delete these two lines if you see a rectangle on canvas, since they are just for testing.</p>
<h5 id="Hexagon"><a href="#Hexagon" class="headerlink" title="Hexagon"></a>Hexagon</h5><p>Now we need to create a particle. I have decided to go with <a href="https://en.wikipedia.org/wiki/Hexagon" target="_blank" rel="noopener">hexagon</a> for this tutorial. For drawing one we’re going to use canvas lines, since there is no built in hexagon element. Should be simple enought, only thing that we need are vertices.</p>
<p>First challenge is where to draw it, and it would be good to draw it around position (0,0). Issue is canvas element has it’s origin in top left corner. Best action would be to move canvas origin to center of screen. To do that, add following lines just after context call.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">context.translate(width / <span class="number">2</span>, height / <span class="number">2</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Now for drawing hexagon, we really need to know it’s points. Finding them involes a bit of <a href="https://en.wikipedia.org/wiki/Trigonometry" target="_blank" rel="noopener">trigonometry</a>. Let’s do it with radius of 5 for hexagon.</p>
<p>Before drawing example, just know that hexagon is made out of 6 triangles. Which means 6 angles around center, for the one that we’re going to draw.</p>
<p><img src="/images/4/image1.png" style="width:50%"></p>
<p>How do we know it’s 60 degrees for angle. Well easy, 360 divided by 6 triangles gives 60 per one.</p>
<p>Getting positions (-5, 0) and (5, 0) is easy since y is 0. But what about other positions.<br>That’s why I have drawn that triangle outside of hexagon, we can really get all positions just from it. First we know the length of hypotenuse, which is also a radius. Second we know that angle is 60 degrees.<br>You might know or remember that we can use <em>cos</em> to get adjecent side which is X. For Y side we’re going to use <em>sin</em>  function.</p>
<p><img src="/images/4/image2.png" style="width:50%"> </p>
<p>All other points are just combinations of those two with positive and negatives.<br>SO let’s add these points right after <em>translate</em> call<br>.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">context.beginPath();</span><br><span class="line"></span><br><span class="line">context.moveTo(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line">context.lineTo(<span class="number">2.5</span>, <span class="number">-4.3</span>);</span><br><span class="line">context.lineTo(<span class="number">-2.5</span>, <span class="number">-4.3</span>);</span><br><span class="line">context.lineTo(<span class="number">-5</span>, <span class="number">0</span>);</span><br><span class="line">context.lineTo(<span class="number">-2.5</span>, <span class="number">4.3</span>);</span><br><span class="line">context.lineTo(<span class="number">2.5</span>,<span class="number">4.3</span>);</span><br><span class="line"></span><br><span class="line">context.fill();</span><br><span class="line">context.closePath();</span><br></pre></td></tr></table></figure></p>
<p><em>beginPath</em> just tells context that it’s ready to draw. <em>moveTo</em> says where to start from, <em>lineTo</em> where to move to.<br><em>fill</em> will, well fill drawn shape. And <em>closePath</em> tells that we are done.</p>
<p> If you check your browser now, there is a hexagon, but it’s rather small. I could have drawn it bigger, but we’re going to have lots of them, so better to leave it as it is, unless we want to create more job four ourselfs later.<br> Instead we can enlarge canvas. Right after <em>translate</em> and before <em>beginPath</em> add this line</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.scale(<span class="number">10</span>,<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>We are going to delete this line, sometime later, since it won’t be needed.</p>
<h5 id="Particle"><a href="#Particle" class="headerlink" title="Particle"></a>Particle</h5><p>Now that one hexagon doesn’t really do much. We’re going to have hundreds of them and all of them need to have their own scale, color, position and movement direction. That can be caputered in a object. We’re also going to need some object to operate with positions, direction etc… That’s going to be a <em>Vector</em> instance.<br>So next thing to do is to create a vector definition. To do that, let’s add constructor function and prototype for it.</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector.prototype = &#123;</span><br><span class="line">    addTo: <span class="function"><span class="keyword">function</span>(<span class="params">vector</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x += vector.x;</span><br><span class="line">        <span class="keyword">this</span>.y += vector.y;</span><br><span class="line">    &#125;,</span><br><span class="line">    multiplyBy: <span class="function"><span class="keyword">function</span>(<span class="params">scalar</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x *= scalar;</span><br><span class="line">        <span class="keyword">this</span>.y *= scalar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>Prototype</em> is bit confusing concept in <em>javaScript</em> when compared to object oriented programming languages, but that this is correct way to define methods.<br>You could define methods inside constuctor function (Vector), but then it would be duplicated for every <em>Vector</em> instance, meaning defined again in memory. When defined on prototype, every instance shares those methods. I would encourage you to read about <em>prototypes</em> in JavaScript a bit, this is really topic on it’s own.</p>
<p>Now let’s create <em>Particle</em> constructor function and prototype.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hexCoords = [</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">5</span>,<span class="number">0</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.position = position || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.direction = direction || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Particle.prototype = &#123;</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span>(<span class="params">context</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.position.addTo(<span class="keyword">this</span>.direction);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] + <span class="keyword">this</span>.position.x;</span><br><span class="line">        <span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i+<span class="number">1</span>] + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(posX, posY);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; <span class="keyword">this</span>.hexCoords.length; i+=<span class="number">2</span>)&#123;</span><br><span class="line">            posX = <span class="keyword">this</span>.hexCoords[i] + <span class="keyword">this</span>.position.x;</span><br><span class="line">            posY = <span class="keyword">this</span>.hexCoords[i+<span class="number">1</span>] + <span class="keyword">this</span>.position.y;</span><br><span class="line">            context.lineTo(posX, posY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Constructor function just defines vertices for hexagon and properties position and direction.</p>
<p>In update method, line <em>this.position.addTo(this.direction);</em> will add a tiny bit of direction to particle on every update call. Meaning if we’re on position (2,2) and direction vector is (1,0), we are moving to position (3,2), next frame to (4,2) etc… </p>
<p>For next line, quick note. Our hexagon was drawn around (0,0) with purpose. It’s easier to calculate positions by simply adding position to coordinates if they are around (0,0). That’s how we move hexagon. It’s lines are redrawn on every update call with added position.</p>
<p>For loop, make sure that it starts at 2, since first two coordinates are used for <em>moveTo</em> call. Also it’s incremented by 2, don’t be silly and make a bug like I did while working on this :) </p>
<p>Next thing to do is to add particles and actually render them.<br>Inside <em>load</em> function delete all the lines below <em>context</em> call, we don’t need them anymore.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// delete this</span></span><br><span class="line">    context.translate(width / <span class="number">2</span>, height / <span class="number">2</span>);</span><br><span class="line">    context.scale(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    context.beginPath();</span><br><span class="line"></span><br><span class="line">    context.moveTo(<span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">    context.lineTo(<span class="number">2.5</span>, <span class="number">-4.3</span>);</span><br><span class="line">    context.lineTo(<span class="number">-2.5</span>, <span class="number">-4.3</span>);</span><br><span class="line">    context.lineTo(<span class="number">-5</span>, <span class="number">0</span>);</span><br><span class="line">    context.lineTo(<span class="number">-2.5</span>, <span class="number">4.3</span>);</span><br><span class="line">    context.lineTo(<span class="number">2.5</span>, <span class="number">4.3</span>);</span><br><span class="line"></span><br><span class="line">    context.fill();</span><br><span class="line">    context.closePath();</span><br></pre></td></tr></table></figure>
<p>and add</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particles = [],</span><br><span class="line">      particlesCount = <span class="number">100</span>,</span><br><span class="line">      minSpeed = <span class="number">0.5</span>,</span><br><span class="line">      maxSpeed = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createParticles</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      particles = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particlesCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> dirX = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">          <span class="keyword">var</span> dirY = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">          dirX *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">          dirY *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> position = <span class="keyword">new</span> Vector(<span class="built_in">Math</span>.random() * width, <span class="built_in">Math</span>.random() * height),</span><br><span class="line">              direction = <span class="keyword">new</span> Vector(dirX, dirY);</span><br><span class="line">          particles.push(<span class="keyword">new</span> Particle(position, direction));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      context.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particles.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> p = particles[i];</span><br><span class="line">          p.update(context);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (p.position.x &lt; <span class="number">0</span> || p.position.x &gt; width) &#123;</span><br><span class="line">              p.direction.x *= <span class="number">-1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (p.position.y &lt; <span class="number">0</span> || p.position.y &gt; height) &#123;</span><br><span class="line">              p.direction.y *= <span class="number">-1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      requestAnimationFrame(update);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createParticles();</span><br><span class="line">  update();</span><br></pre></td></tr></table></figure>
<p>Well this is quite a lot, but it’s really simple. We add some variables for count, speed and array for particles.<br>Now it’s time to actually create some.<br>This is all basic stuff. <code>Math.random() * (maxSpeed - minSpeed) + minSpeed;</code> which gives us some random number between minimum and maximum speed for particle direction.<br><code>dirX*= Math.random() &gt; 0.5 ? 1 : -1;</code> will decide if it goes towards positive or negative direction. </p>
<p>Other lines really just create some vector and particle instance, which is added to particles array.</p>
<p><em>Update</em> function is bit more involved, first thing it does is, it clears context before new draw with line *clearRect(0,0,width, height). This removes all what was drawn in previous frame.<br>Next is simple loop over particles and call to update method. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (p.position.x &lt; <span class="number">0</span> || p.position.x &gt; width) &#123;</span><br><span class="line">    p.direction.x *= <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>line detects if particle has left the screen on X axis, if so, it changes the x direction of particle. Same is true for y part.</p>
<p>You should have some flying and bouncing hexagon particles by now, if not here is all the code from js file.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">        width = <span class="built_in">window</span>.innerWidth,</span><br><span class="line">        height = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"></span><br><span class="line">    canvas.width = width;</span><br><span class="line">    canvas.height = height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> particles = [],</span><br><span class="line">        particlesCount = <span class="number">100</span>,</span><br><span class="line">        minSpeed = <span class="number">0.5</span>,</span><br><span class="line">        maxSpeed = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createParticles</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particles = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particlesCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> dirX = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            <span class="keyword">var</span> dirY = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            dirX *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">            dirY *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> position = <span class="keyword">new</span> Vector(<span class="built_in">Math</span>.random() * width, <span class="built_in">Math</span>.random() * height),</span><br><span class="line">                direction = <span class="keyword">new</span> Vector(dirX, dirY);</span><br><span class="line">            particles.push(<span class="keyword">new</span> Particle(position, direction));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        context.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particles.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> p = particles[i];</span><br><span class="line">            p.update(context);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (p.position.x &lt; <span class="number">0</span> || p.position.x &gt; width) &#123;</span><br><span class="line">                p.direction.x *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (p.position.y &lt; <span class="number">0</span> || p.position.y &gt; height) &#123;</span><br><span class="line">                p.direction.y *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        requestAnimationFrame(update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createParticles();</span><br><span class="line">    update();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector.prototype = &#123;</span><br><span class="line">    addTo: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x += vector.x;</span><br><span class="line">        <span class="keyword">this</span>.y += vector.y;</span><br><span class="line">    &#125;,</span><br><span class="line">    multiplyBy: <span class="function"><span class="keyword">function</span> (<span class="params">scalar</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x *= scalar;</span><br><span class="line">        <span class="keyword">this</span>.y *= scalar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hexCoords = [</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.position = position || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.direction = direction || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Particle.prototype = &#123;</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.position.addTo(<span class="keyword">this</span>.direction);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] + <span class="keyword">this</span>.position.x;</span><br><span class="line">        <span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(posX, posY);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; <span class="keyword">this</span>.hexCoords.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            posX = <span class="keyword">this</span>.hexCoords[i] + <span class="keyword">this</span>.position.x;</span><br><span class="line">            posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] + <span class="keyword">this</span>.position.y;</span><br><span class="line">            context.lineTo(posX, posY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Color-scale-and-animation"><a href="#Color-scale-and-animation" class="headerlink" title="Color, scale and animation"></a>Color, scale and animation</h5><p>It is time to color particles a bit. We’re also going to add some transaprency as well.<br>First we should add color and alpha properties to <em>Particle</em> constructor function. Color will be function parameter as well.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction, color</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hexCoords = [</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.position = position || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.direction = direction || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.color = color || <span class="string">'rgb(	49, 140, 231)'</span>;</span><br><span class="line">    <span class="keyword">this</span>.alpha = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.alphaChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There is also <em>alphaChangeRate</em> property. This is just some random number to muliply by. It would be weird to see all the particles with same fade out/fade in speed and this is simple way to randomize it a bit.</p>
<p>Now it’s time to change the update method.<br>First thing that we need to do is add <em>time</em> parameter. Add <em>time</em> as second parameter to existing update method.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Particle.prototype = &#123;</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">context, time</span>) </span>&#123;</span><br></pre></td></tr></table></figure>
<p>Next before <em>beginPath</em> call add this.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">this</span>.alpha = <span class="number">0.5</span> + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.alphaChangeRate) * <span class="number">0.5</span>;</span><br><span class="line">context.globalAlpha = <span class="keyword">this</span>.alpha;</span><br><span class="line"></span><br><span class="line">context.beginPath();  <span class="comment">// this line should already be in code</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>What we’re doing here is creating alpha value between 0 and 1 that will make our particles transparent. I will explain  part with cos in details bit later and why I use it.<br>And finally we need to assign a color to our shape, just before <em>fill</em> call.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">context.fillStyle = <span class="keyword">this</span>.color;</span><br><span class="line">context.fill();<span class="comment">// this line should already be in code</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>context.fillStyle = this.color;</em> just fills hexagon particle with given color. I’m using this <em>rgb(49, 140, 231)</em> which gives it a light blue color.</p>
<p>Now about <em>0.5 + Math.cos(time </em> this.alphaChangeRate) <em> 0.5;</em></p>
<p>What I like to use for simple animations are <em>cos</em> or <em>sin</em> functions. <em>Cos</em> will always return value between -1 and 1, starting with 1 when time is 0.<br>But I need value between 0 and 1 for transparency. When I multiply value from <em>cos</em> by 0.5, I get value between -0.5 and 0.5. <em>0.5 + </em> part will move that to 0 to 1 range, since I can’t really have negative transparency.<br>And perfect, I have looping animation.</p>
<p>I do really recommend reading a trigonometry a bit if you plan to work game development or animations like this. It really helps a lot.<br>Perfect way to learn it, aside from tutorials and books, is to use some tools, for example <a href="https://www.desmos.com/calculator/xqbbcd1gkr" target="_blank" rel="noopener">desmos graph</a>. It really helps with functions.<br>Try going to this page and entering this <em>f(x) = 0.5 + cos(x) </em> 0.5* into any input box. As you can see, values are going between 0 and 1 for any x. Which is just what we need. </p>
<p>We still need to pass time variable. Add time just after all the others variable declarations</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particles = [],</span><br><span class="line">    particlesCount = <span class="number">100</span>,</span><br><span class="line">    minSpeed = <span class="number">0.5</span>,</span><br><span class="line">    maxSpeed = <span class="number">2</span>,</span><br><span class="line">    time = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>Find <em>p.update</em> line and change it to<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.update(context, time);</span><br></pre></td></tr></table></figure></p>
<p>And finally just before <em>requestAnimationFrame</em> line add</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time += <span class="number">0.01</span>;</span><br><span class="line">requestAnimationFrame(update);</span><br></pre></td></tr></table></figure>
<p>And that’s it, you should have blue hexagons that are chaning their transparency at different rates.</p>
<p><img src="/images/4/image3.png" style="width:50%"></p>
<p><strong>Scale</strong> will have same basic idea with <em>cos</em> function, where we change scale based on some rate between min and max values.</p>
<p>You know the drill, expaned <em>Particle</em> constructor function with additional parameters and properties.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction, color, minScale, maxScale</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">this</span>.minScale = minScale || <span class="number">1</span>;</span><br><span class="line"><span class="keyword">this</span>.maxScale = maxScale || <span class="number">1</span>;</span><br><span class="line"><span class="keyword">this</span>.scaleChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In particle update method add following<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Particle.prototype = &#123;</span><br><span class="line">update: <span class="function"><span class="keyword">function</span> (<span class="params">context, time</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.scale = <span class="keyword">this</span>.minScale + ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>) + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.scaleChangeRate) * ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>);</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<p>Scale function looks scary, but it’s same basic idea as before. Loop between min and max value. Let’s say that I want 2 for min and 5 for max. Check the second function on this <a href="https://www.desmos.com/calculator/i3avpvsnjv" target="_blank" rel="noopener">Graph</a>.<br>X is our time and as time changes it loops between 2 and 5. Perfect.</p>
<p>To scale particles, multiply <em>hexCoords</em> by scale factor and then add positions.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Change </span><br><span class="line"><span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] + <span class="keyword">this</span>.position.x;</span><br><span class="line"><span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>]  + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line"><span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">and </span><br><span class="line"></span><br><span class="line">posX = <span class="keyword">this</span>.hexCoords[i] + <span class="keyword">this</span>.position.x;</span><br><span class="line">posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>]  + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line"></span><br><span class="line">posX = <span class="keyword">this</span>.hexCoords[i] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line">posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br></pre></td></tr></table></figure>
<p>Next we need to define min and max scale variables and pass them to constructor.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particles = [],</span><br><span class="line">        particlesCount = <span class="number">100</span>,</span><br><span class="line">        minSpeed = <span class="number">0.5</span>,</span><br><span class="line">        maxSpeed = <span class="number">2</span>,</span><br><span class="line">        time = <span class="number">0</span>,</span><br><span class="line">        minScale = <span class="number">1</span>,</span><br><span class="line">        maxScale = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">particles.push(<span class="keyword">new</span> Particle(position, direction, <span class="literal">null</span>, minSize, maxSize));</span><br></pre></td></tr></table></figure>
<p>I’ve passed <em>null</em> for color since I’m happy with defualt blue one, but feel free to pass other colors in hex or rgb format.</p>
<p>And that should be it for this part. You should have particles that are varying their size and transparency.</p>
<p><img src="/images/4/image4.png" style="width:50%"></p>
<p>All code so far</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">        width = <span class="built_in">window</span>.innerWidth,</span><br><span class="line">        height = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"></span><br><span class="line">    canvas.width = width;</span><br><span class="line">    canvas.height = height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> particles = [],</span><br><span class="line">        particlesCount = <span class="number">100</span>,</span><br><span class="line">        minSpeed = <span class="number">0.5</span>,</span><br><span class="line">        maxSpeed = <span class="number">2</span>,</span><br><span class="line">        time = <span class="number">0</span>,</span><br><span class="line">        minSize = <span class="number">1</span>,</span><br><span class="line">        maxSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createParticles</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particles = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particlesCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> dirX = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            <span class="keyword">var</span> dirY = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            dirX *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">            dirY *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> position = <span class="keyword">new</span> Vector(<span class="built_in">Math</span>.random() * width, <span class="built_in">Math</span>.random() * height),</span><br><span class="line">                direction = <span class="keyword">new</span> Vector(dirX, dirY);</span><br><span class="line">            particles.push(<span class="keyword">new</span> Particle(position, direction, <span class="literal">null</span>, minSize, maxSize));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        context.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particles.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> p = particles[i];</span><br><span class="line">            p.update(context, time);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (p.position.x &lt; <span class="number">0</span> || p.position.x &gt; width) &#123;</span><br><span class="line">                p.direction.x *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (p.position.y &lt; <span class="number">0</span> || p.position.y &gt; height) &#123;</span><br><span class="line">                p.direction.y *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        time += <span class="number">0.01</span>;</span><br><span class="line">        requestAnimationFrame(update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createParticles();</span><br><span class="line">    update();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector.prototype = &#123;</span><br><span class="line">    addTo: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x += vector.x;</span><br><span class="line">        <span class="keyword">this</span>.y += vector.y;</span><br><span class="line">    &#125;,</span><br><span class="line">    multiplyBy: <span class="function"><span class="keyword">function</span> (<span class="params">scalar</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x *= scalar;</span><br><span class="line">        <span class="keyword">this</span>.y *= scalar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction, color, minScale, maxScale</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hexCoords = [</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.position = position || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.direction = direction || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.color = color || <span class="string">'rgb(	49, 140, 231)'</span>;</span><br><span class="line">    <span class="keyword">this</span>.alpha = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.alphaChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line">    <span class="keyword">this</span>.minScale = minScale || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.maxScale = maxScale || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.scaleChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Particle.prototype = &#123;</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">context, time</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scale = <span class="keyword">this</span>.minScale + ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>) + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.scaleChangeRate) * ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.position.addTo(<span class="keyword">this</span>.direction);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line">        <span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.alpha = <span class="number">0.5</span> + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.alphaChangeRate) * <span class="number">0.5</span>;</span><br><span class="line">        context.globalAlpha = <span class="keyword">this</span>.alpha;</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(posX, posY);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; <span class="keyword">this</span>.hexCoords.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            posX = <span class="keyword">this</span>.hexCoords[i] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line">            posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br><span class="line">            context.lineTo(posX, posY);</span><br><span class="line">        &#125;</span><br><span class="line">        context.fillStyle = <span class="keyword">this</span>.color;</span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Lines"><a href="#Lines" class="headerlink" title="Lines"></a>Lines</h5><p>For lines we’re going to need to compare all the particles with each one.<br>It’s just a matter of adding another loop for particles inside existing one.<br>But first, let’s expand ‘Vector’ with distance method, since we’re going to need it for this part.</p>
<p>Add it right after <em>multiplyBy</em> method.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distance: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dx = <span class="keyword">this</span>.x - vector.x;</span><br><span class="line">    <span class="keyword">var</span> dy = <span class="keyword">this</span>.y - vector.y;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(dx * dx + dy * dy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’re also going to need radius property for particles. So expand <em>Particle</em> constructor function yet again.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction, color, minScale, maxScale, radius</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">this</span>.radius = radius || <span class="number">50</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now in update method, after edge checks add<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; particles.length; j++) &#123;</span><br><span class="line">     <span class="keyword">var</span> p2 = particles[j];</span><br><span class="line">     <span class="keyword">var</span> distance = p.position.distance(p2.position);</span><br><span class="line">     <span class="keyword">var</span> radiusSum = p.radius + p2.radius;</span><br><span class="line">     <span class="keyword">if</span> (distance &lt; radiusSum) &#123;</span><br><span class="line">         context.globalAlpha = <span class="number">1</span> - distance / radiusSum;</span><br><span class="line">         context.beginPath();</span><br><span class="line">         context.moveTo(p.position.x, p.position.y);</span><br><span class="line">         context.lineTo(p2.position.x, p2.position.y);</span><br><span class="line">         context.strokeStyle = <span class="string">'rgb(49, 140, 231)'</span>;</span><br><span class="line">         context.stroke();</span><br><span class="line">         context.closePath();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p> So distance formula is used to get, well a distance and if it’s less then sum of particles radius we have a true condition and proceed to draw a line between two particles.</p>
<p> Particle positions are ends of line, so particle 1 is one end, particle 2 other.</p>
<p><img src="/images/4/image5.png"> </p>
<p>As for distance, I have already covered it in one of my <a href="/2018/06/24/Low-Poly-Terrain-Part-2-Terrain-Generation/#distance">posts</a>.<br>Line <em>context.globalAlpha = 1 - distance / radiusSum;</em> adds amount of alpha. Bigger the distance is, less amount is applied. Rest of the lines shouldn’t be anything new by now, those just create line using particle 1 and 2 positions.</p>
<p>So after all this you should get </p>
<p><img src="/images/4/image6.png" style="width:75%"></p>
<p>All code so far.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">        width = <span class="built_in">window</span>.innerWidth,</span><br><span class="line">        height = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"></span><br><span class="line">    canvas.width = width;</span><br><span class="line">    canvas.height = height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> particles = [],</span><br><span class="line">        particlesCount = <span class="number">100</span>,</span><br><span class="line">        minSpeed = <span class="number">0.5</span>,</span><br><span class="line">        maxSpeed = <span class="number">2</span>,</span><br><span class="line">        time = <span class="number">0</span>,</span><br><span class="line">        minSize = <span class="number">1</span>,</span><br><span class="line">        maxSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createParticles</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        particles = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particlesCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> dirX = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            <span class="keyword">var</span> dirY = <span class="built_in">Math</span>.random() * (maxSpeed - minSpeed) + minSpeed;</span><br><span class="line">            dirX *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">            dirY *= <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> position = <span class="keyword">new</span> Vector(<span class="built_in">Math</span>.random() * width, <span class="built_in">Math</span>.random() * height),</span><br><span class="line">                direction = <span class="keyword">new</span> Vector(dirX, dirY);</span><br><span class="line">            particles.push(<span class="keyword">new</span> Particle(position, direction, <span class="literal">null</span>, minSize, maxSize));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        context.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particles.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> p = particles[i];</span><br><span class="line">            p.update(context, time);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (p.position.x &lt; <span class="number">0</span> || p.position.x &gt; width) &#123;</span><br><span class="line">                p.direction.x *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (p.position.y &lt; <span class="number">0</span> || p.position.y &gt; height) &#123;</span><br><span class="line">                p.direction.y *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; particles.length; j++) &#123;</span><br><span class="line">                <span class="keyword">var</span> p2 = particles[j];</span><br><span class="line">                <span class="keyword">var</span> distance = p.position.distance(p2.position);</span><br><span class="line">                <span class="keyword">var</span> radiusSum = p.radius + p2.radius;</span><br><span class="line">                <span class="keyword">if</span> (distance &lt; radiusSum) &#123;</span><br><span class="line">                    context.globalAlpha = <span class="number">1</span> - distance / radiusSum;</span><br><span class="line">                    context.beginPath();</span><br><span class="line">                    context.moveTo(p.position.x, p.position.y);</span><br><span class="line">                    context.lineTo(p2.position.x, p2.position.y);</span><br><span class="line">                    context.strokeStyle = <span class="string">'rgb(49, 140, 231)'</span>;</span><br><span class="line">                    context.stroke();</span><br><span class="line">                    context.closePath();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        time += <span class="number">0.01</span>;</span><br><span class="line">        requestAnimationFrame(update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createParticles();</span><br><span class="line">    update();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector.prototype = &#123;</span><br><span class="line">    addTo: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x += vector.x;</span><br><span class="line">        <span class="keyword">this</span>.y += vector.y;</span><br><span class="line">    &#125;,</span><br><span class="line">    multiplyBy: <span class="function"><span class="keyword">function</span> (<span class="params">scalar</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x *= scalar;</span><br><span class="line">        <span class="keyword">this</span>.y *= scalar;</span><br><span class="line">    &#125;,</span><br><span class="line">    distance: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> dx = <span class="keyword">this</span>.x - vector.x;</span><br><span class="line">        <span class="keyword">var</span> dy = <span class="keyword">this</span>.y - vector.y;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(dx * dx + dy * dy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Particle</span>(<span class="params">position, direction, color, minScale, maxScale, radius</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hexCoords = [</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">-4.3</span>,</span><br><span class="line">        <span class="number">-5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">-2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">2.5</span>, <span class="number">4.3</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">0</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.position = position || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.direction = direction || <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">this</span>.color = color || <span class="string">'rgb(	49, 140, 231)'</span>;</span><br><span class="line">    <span class="keyword">this</span>.alpha = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.alphaChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line">    <span class="keyword">this</span>.minScale = minScale || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.maxScale = maxScale || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.scaleChangeRate = <span class="built_in">Math</span>.random();</span><br><span class="line">    <span class="keyword">this</span>.radius = radius || <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Particle.prototype = &#123;</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params">context, time</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scale = <span class="keyword">this</span>.minScale + ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>) + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.scaleChangeRate) * ((<span class="keyword">this</span>.maxScale - <span class="keyword">this</span>.minScale) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.position.addTo(<span class="keyword">this</span>.direction);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> posX = <span class="keyword">this</span>.hexCoords[<span class="number">0</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line">        <span class="keyword">var</span> posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.alpha = <span class="number">0.5</span> + <span class="built_in">Math</span>.cos(time * <span class="keyword">this</span>.alphaChangeRate) * <span class="number">0.5</span>;</span><br><span class="line">        context.globalAlpha = <span class="keyword">this</span>.alpha;</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(posX, posY);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; <span class="keyword">this</span>.hexCoords.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            posX = <span class="keyword">this</span>.hexCoords[i] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.x;</span><br><span class="line">            posY = <span class="keyword">this</span>.hexCoords[i + <span class="number">1</span>] * <span class="keyword">this</span>.scale + <span class="keyword">this</span>.position.y;</span><br><span class="line">            context.lineTo(posX, posY);</span><br><span class="line">        &#125;</span><br><span class="line">        context.fillStyle = <span class="keyword">this</span>.color;</span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Pushing-away-from-mouse"><a href="#Pushing-away-from-mouse" class="headerlink" title="Pushing away from mouse"></a>Pushing away from mouse</h5><p>We’re taking similar approach as we had with particles. We’re going to need to get distance between mouse and particles. And then push them away. Start by adding new variable called <em>repulseDistance</em>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> particles = [],</span><br><span class="line">        particlesCount = <span class="number">100</span>,</span><br><span class="line">        minSpeed = <span class="number">0.5</span>,</span><br><span class="line">        maxSpeed = <span class="number">2</span>,</span><br><span class="line">        time = <span class="number">0</span>,</span><br><span class="line">        minSize = <span class="number">1</span>,</span><br><span class="line">        maxSize = <span class="number">3</span>,</span><br><span class="line">        repulseDistance = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p>We’re going to need couple of new methods for our <em>Vector</em>.<br>So add these to <em>Vector.prototype</em> right after distance.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">diff: <span class="function"><span class="keyword">function</span> (<span class="params">vector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vector(<span class="keyword">this</span>.x - vector.x, <span class="keyword">this</span>.y - vector.y);</span><br><span class="line">&#125;,</span><br><span class="line">getLength: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="keyword">this</span>.x * <span class="keyword">this</span>.x + <span class="keyword">this</span>.y * <span class="keyword">this</span>.y);</span><br><span class="line">&#125;,</span><br><span class="line">setLength: <span class="function"><span class="keyword">function</span> (<span class="params">newLength</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.multiplyBy(newLength / <span class="keyword">this</span>.getLength());</span><br><span class="line">&#125;,</span><br><span class="line">normalize: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> length = <span class="keyword">this</span>.getLength();</span><br><span class="line">  <span class="keyword">this</span>.x /= length;</span><br><span class="line">  <span class="keyword">this</span>.y /= length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>diff</em> is just a vector subtraction. Get length, gets a length with usual distance formula. Set length, well this is one way to set it, without involving angles. So if we had length of 2 and want to apply length of 8, we divide 8/2 get 4 and multiply x and y by 4. Length can also be called magnitude. Vector is simply something with direction and length. </p>
<p>See this normalized vector example, those are vectors of same direction, but with different length. It also explains normalization, which is just a vector with length of 1.</p>
<p><img src="/images/4/image7.png" style="width:50%"></p>
<p>Finally add this code after update method<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">canvas.addEventListener(<span class="string">"mousemove"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> mousePos = <span class="keyword">new</span> Vector(e.x, e.y);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; particles.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> p = particles[i];</span><br><span class="line">          <span class="keyword">var</span> distance = p.position.distance(mousePos);</span><br><span class="line">          <span class="keyword">if</span> (distance &lt; repulseDistance) &#123;</span><br><span class="line">              <span class="keyword">var</span> dir = p.position.diff(mousePos);</span><br><span class="line">              dir.normalize();</span><br><span class="line">              dir.setLength(repulseDistance - distance);</span><br><span class="line">              p.position.addTo(dir);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p>
<p>This defines <em>mousemove</em> event handler, which will caputure any mouse movement on cavas. Event sends some data which has usefull properties such as mouse positions in terms of x and y.<br>We get distance between particle and mouse. It if less then <em>repulseDistance</em> we need to move vector away from mouse.<br>For that we need to know in which direction, that is what <em>diff</em> does, by subtracting them. We need to calc correct distance, that’s why vector is normalized before we assing new corrected length, remember normalized vector has a length of 1, that’s why we can calc new position. Last line simply adds that difference to particle position.</p>
<p>And there, that should be all. Now all the particles should move away from mouse :)</p>
<p>Code as always is available at <a href="https://github.com/luka712/Canvas-Coding/tree/master/Hexagon%20Particles" target="_blank" rel="noopener">Github</a>.</p>
</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.3.0-alpha.12/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="https://preview.babylonjs.com/gui/babylon.gui.js"></script><script src="/scripts/index.js" type="text/javascript"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-121717766-1');ga('send','pageview');</script></body></html>