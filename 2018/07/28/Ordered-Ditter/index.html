<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Ordered Dithering | luka712 blog</title><meta name="description" content="A brief introduction to dithering and implementation of Ordered Dither"><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/About" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Ordered Dithering</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-07-28T20:21:18.000Z"> Saturday, July 28th 2018 at 22:21</time><br>Last updated on<time itemprop="dateModified" datetime="2018-07-28T20:21:18.000Z"> Sunday, July 29th 2018 at 11:17</time></span><h5 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h5><p><strong>What is dither?</strong> In this context, it is a way of dealing with limited color pallete and at the same time creating illusion of color depth.</p>
<p>Take a look at image here:</p>
<p><img src="https://en.wikipedia.org/wiki/Dither#/media/File:Dithering_example_red_blue.png"></p>
<p>You may notice that there are only 2 colors, red and blue. But at square get smaller, we percieve it as purple. That’s what dithering is trying to achieve. Here is [read] (<a href="https://en.wikipedia.org/wiki/Dither#/media/File:Dithering_example_red_blue.png" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Dither#/media/File:Dithering_example_red_blue.png</a>) about dithering, if you’re intrested in different ditering algorithms.</p>
<p>This is effect that our dither will have on image</p>
<p><img src="/images/7/image1.png" style="width:50%"></p>
<p>What you might not notice, is that only 2 colors are used here, black and white. That’s how dither effect will work.<br>We’re going to turn image into gray and then compare gray to values in threshold matrix. If it passes them, white is returned, if not black will be returned.</p>
<h5 id="Starting-and-Grayscale"><a href="#Starting-and-Grayscale" class="headerlink" title="Starting and Grayscale"></a>Starting and Grayscale</h5><p>Go to <a href="https://www.shadertoy.com/new" target="_blank" rel="noopener">shadertoy</a> and start with this code. Also make sure to select some texture for iChannel0.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line">	<span class="type">vec4</span> col = <span class="built_in">texture</span>(iChannel0, uv);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Output to screen</span></span><br><span class="line">    fragColor = col;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now what is <em>Grayscale</em>. You might think that’s it’s color, but it is actually amount of light. We just have white as strongest shade and black as weakest. More <a href="https://en.wikipedia.org/wiki/Grayscale" target="_blank" rel="noopener">here</a>.</p>
<p>We can get <a href="brightness of image">luma</a> with formula:</p>
<p><em>Y=0.2126R+0.7152G+0.0722B</em></p>
<p>where R,G and B are red, green and blue colors. You might also notice, that whole expression seems like dot product between two vectors.</p>
<p>Y = dot(col, lum)<br>Y = col.x <em> lum.x + col.y </em> lum.y + col.z * lum.z ( instead of xyz, rgb can be used).</p>
<p>therefore</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> luma = <span class="built_in">dot</span>(<span class="type">vec3</span>(<span class="number">0.2126</span>, <span class="number">0.7152</span>, <span class="number">0.0722</span>), col.rgb);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Output to screen</span></span><br><span class="line">fragColor = <span class="type">vec4</span>(luma);</span><br></pre></td></tr></table></figure>
<p>And that’s it for grayscale.</p>
<p><img src="/images/7/image2.png" style="width:50%"></p>
<h5 id="Dither"><a href="#Dither" class="headerlink" title="Dither"></a>Dither</h5><p>As I mentioned, ordered dither simply compares given value against threshold matrix, if it passes it white is returned, else black color is returned. Start with threshold matrix.<br>Add is just before <em>main_image</em> function.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="type">mat4x4</span> threshold = <span class="type">mat4x4</span>(<span class="number">0.</span>, <span class="number">8.</span>, <span class="number">2.</span>, <span class="number">10.</span>, </span><br><span class="line">                                <span class="number">12.</span>, <span class="number">4.</span>, <span class="number">14.</span>, <span class="number">6.</span>,</span><br><span class="line">                                <span class="number">3.</span>,<span class="number">11.</span>,<span class="number">1.</span>,<span class="number">9.</span>,</span><br><span class="line">                                <span class="number">15.</span>,<span class="number">7.</span>,<span class="number">13.</span>, <span class="number">5.</span>);</span><br></pre></td></tr></table></figure>
<p>Next add find value function. I’m going to explain x and y parameters bit later.<br>As for dividing by 16, we’re doing that to put matrix values in 0 to 1 space ( techinally close to 1, since biggest value in matrix is 15). <em>v &lt; t</em> is comparison between current value <em>v</em> and threshold value <em>t</em>. If v is less, return 1. for white, else return 0 for black.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">float</span> findClosest(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">float</span> v)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">float</span> t = (threshold[x][y]) / <span class="number">16.</span>;</span><br><span class="line">    <span class="keyword">if</span>(v &lt; t)</span><br><span class="line">    &#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="number">0.</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">     	<span class="keyword">return</span> <span class="number">1.</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we need to find x and y. X is simply index from 0 to 3 and same is true for y. This simply means that each 4x4 pixels chunk of screen is going to be compared to dither matrix. Let’s say  that we have 8x6 screen size. Just for example I’m trying to get pixel 7 from x axis and 4 from y axis. See how that corresponds with matrix.</p>
<p><img src="/images/7/image3.png" style="width:50%"></p>
<p>Final step is to compare luminance with matrix.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">luma = findClosest(x,y, luma);</span><br></pre></td></tr></table></figure>
<p>One thing that I failed to mention is that matrix values are entered in column order. That means that 4 numbers (0., 8., 2., 10.) from our first row are actually column. Matrix can be easily changed in <em>findClosest</em> method by transpose operation.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">mat4x4</span> thresholdT = <span class="built_in">transpose</span>(threshold);</span><br><span class="line"><span class="type">float</span> t = (thresholdT[x][y]) / <span class="number">16.</span>;</span><br></pre></td></tr></table></figure>
<p>And that’s it, nice retro visuals with simple shader. I have added all code, but it is also available at <a href="https://www.shadertoy.com/view/4lcyzn" target="_blank" rel="noopener">shadertoy page</a>. </p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="type">mat4x4</span> threshold = <span class="type">mat4x4</span>(<span class="number">0.</span>, <span class="number">8.</span>, <span class="number">2.</span>, <span class="number">10.</span>, </span><br><span class="line">                                <span class="number">12.</span>, <span class="number">4.</span>, <span class="number">14.</span>, <span class="number">6.</span>,</span><br><span class="line">                                <span class="number">3.</span>,<span class="number">11.</span>,<span class="number">1.</span>,<span class="number">9.</span>,</span><br><span class="line">                                <span class="number">15.</span>,<span class="number">7.</span>,<span class="number">13.</span>, <span class="number">5.</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> findClosest(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">float</span> v)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">mat4x4</span> thresholdT = <span class="built_in">transpose</span>(threshold);</span><br><span class="line">    <span class="type">float</span> t = (thresholdT[x][y]) / <span class="number">16.</span>;</span><br><span class="line">    <span class="keyword">if</span>(v &lt; t)</span><br><span class="line">    &#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="number">0.</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">     	<span class="keyword">return</span> <span class="number">1.</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line">    <span class="type">vec4</span> col = <span class="built_in">texture</span>(iChannel0, uv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// https://en.wikipedia.org/wiki/Ordered_dithering</span></span><br><span class="line">   	<span class="type">int</span> x = <span class="type">int</span>(fragCoord.x) % <span class="number">4</span>;</span><br><span class="line">    <span class="type">int</span> y = <span class="type">int</span>(fragCoord.y) % <span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// https://en.wikipedia.org/wiki/Luma_(video)</span></span><br><span class="line">	<span class="type">float</span> luma = <span class="built_in">dot</span>(<span class="type">vec3</span>(<span class="number">0.2126</span>, <span class="number">0.7152</span>, <span class="number">0.0722</span>), col.rgb);</span><br><span class="line">    luma = findClosest(x,y, luma);</span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Output to screen</span></span><br><span class="line">	fragColor = <span class="type">vec4</span>(luma);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.3.0-alpha.12/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="https://preview.babylonjs.com/gui/babylon.gui.js"></script><script src="/scripts/index.js" type="text/javascript"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-121717766-1');ga('send','pageview');</script></body></html>