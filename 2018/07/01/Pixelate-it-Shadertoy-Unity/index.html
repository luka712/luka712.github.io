<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Pixelate it ( Shadertoy, Unity) | luka712 blog</title><meta name="description" content="As a title says, pixelate it and that's what we're going to do. For that we're going to use shaders. You might have heard of them, used them, but what about writing them ? This post covers just that, writing some fragment shaders with help of shadertoy and later Unity engine."><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Pixelate it ( Shadertoy, Unity)</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-07-01T08:59:38.000Z"> Sunday, July 1st 2018 at 10:59</time><br>Last updated on<time itemprop="dateModified" datetime="2018-07-01T08:59:38.000Z"> Monday, July 2nd 2018 at 10:44</time></span><h5 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h5><p><img src="/images/3/image1.png" style="width:50%"></p>
<p>That low res effect is what we’re going to create. Why would somebody even want that ? Don’t know really, but it good intro to shaders and it seems fun to code, so why not :)</p>
<p>I’m going to use <a href="https://www.shadertoy.com/" target="_blank" rel="noopener">shadertoy</a> for first part of post, which allows me to focus only on writing fragment shader( also called pixel shader). If you haven’t already, click on <a href="https://www.shadertoy.com/" target="_blank" rel="noopener">shadertoy</a>. </p>
<h5 id="What-is-shadertoy-and-why"><a href="#What-is-shadertoy-and-why" class="headerlink" title="What is shadertoy and why ?"></a>What is shadertoy and why ?</h5><p>It is an online website for writing fragment shaders. That’s it.<br>Fragment shaders are type of shaders that operate on pixels, meaning that code that we write, executes for each individual pixel.<br>It returns simple color represented by red, green, blue and alpha value.</p>
<p>Why shadertoy ? </p>
<p>There are similar great tools as shadertoy, but I started using shadertoy, so kinda sticking to it.</p>
<h5 id="Code-code-code"><a href="#Code-code-code" class="headerlink" title="Code, code, code"></a>Code, code, code</h5><p>If you click on <a href="https://www.shadertoy.com/new" target="_blank" rel="noopener">new screen</a>  you might see something like this.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Time varying pixel color</span></span><br><span class="line">    <span class="type">vec3</span> col = <span class="number">0.5</span> + <span class="number">0.5</span>*<span class="built_in">cos</span>(iTime+uv.xyx+<span class="type">vec3</span>(<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output to screen</span></span><br><span class="line">    fragColor = <span class="type">vec4</span>(col,<span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you never wrote shader, this might seem both simple and complex at same time. <em>Couple of lines of code, but I don’t know what any of it means.</em> That’s how I felt.</p>
<p>Best point to start is, to rewrite shader a bit.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(uv.x &gt; <span class="number">.7</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// red</span></span><br><span class="line">    	fragColor = <span class="type">vec4</span>(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>,<span class="number">1.</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// blue</span></span><br><span class="line">     	fragColor = <span class="type">vec4</span>(<span class="type">vec3</span>(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>), <span class="number">1.</span>);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>mainImage</em>, think of it as entry function. It gets some data and it creates color for final pixel, meaning that it goes through each pixel on screen and assings color to that pixel. <em>out vec4 fragColor</em> line is output color for  that pixel in <a href="https://en.wikipedia.org/wiki/RGBA_color_space" target="_blank" rel="noopener">RGBA color space</a>. Anything that we assing to <em>fragColor</em> is final color.  We can imagine it like this vec4(red, green, blue, alpha) where colors go from 0.0 to 1.0.</p>
<p>Notice that all numbers in shader are defined as 1., which is same as saying 1.0. That’s because of distinction between floating point numbers (decimal) and integers ( whole numbers). <em>vec</em> struct expect floating point numbers.</p>
<p><em>in vec2 fragCoord</em> defines pixel coordinates which we use to compute a color. There is nice <a href="https://www.shadertoy.com/howto" target="_blank" rel="noopener">how to</a> on shadertoy page which explains this.</p>
<p>Line <em>vec2 uv = fragCoord/iResolution.xy;</em> puts fragCoordinates in 0.0 to 1.0 space.</p>
<p>Lines<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(uv.x &gt; <span class="number">.7</span>)</span><br><span class="line">&#123;</span><br><span class="line">   fragColor = <span class="type">vec4</span>(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>,<span class="number">1.</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   fragColor = <span class="type">vec4</span>(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">1.</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>are coloring every pixel that has x coordinate above 0.7 ( in normalized space) to red. Otherwise use blue. </p>
<p>If it’s still bit muddy, this image might make it clear.</p>
<p><img src="/images/3/image2.png" style="width:75%"></p>
<p>Try running this shader. There is a play button below text editor on shadertoy page.</p>
<p>For next part of tutorial, we’re going to need to use textures.<br>Rewrite shader to this<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line"></span><br><span class="line">    fragColor = <span class="built_in">texture</span>(iChannel0, uv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Shader screen will be black if you run it now, that’s because we do not have any texture. If you look at <a href="https://www.shadertoy.com/new" target="_blank" rel="noopener">shadertoy</a> just below text editor there are channels with sample images,videos, music. Set any image or video to <em>iChannel0</em>.</p>
<p>Run it with texture selected and there you have it.<br>Line <em>fragColor = texture(iChannel0, uv);</em> assigns texture from <em>iChannel0</em> to color. <em>Uv</em> provides coordinates mapping. Try multiplaying <em>uv</em> by 5 just for fun to see how textures behave and why normalized space should be used.</p>
<h5 id="Creating-pixelated-images"><a href="#Creating-pixelated-images" class="headerlink" title="Creating pixelated images"></a>Creating pixelated images</h5><p>Let me first start with code.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Normalized pixel coordinates (from 0 to 1)</span></span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord/iResolution.xy;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> onePixelSizeX = <span class="number">1.0</span> / iResolution.x;</span><br><span class="line">    <span class="type">float</span> onePixelSizeY = <span class="number">1.0</span> / iResolution.y;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> cellSizeX =  <span class="number">4.0</span> * onePixelSizeX;</span><br><span class="line">    <span class="type">float</span> cellSizeY = <span class="number">4.0</span> * onePixelSizeY;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> x = cellSizeX * <span class="built_in">floor</span>(uv.x / cellSizeX);</span><br><span class="line">    <span class="type">float</span> y = cellSizeY * <span class="built_in">floor</span>(uv.y / cellSizeY);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// Output to screen</span></span><br><span class="line">    fragColor = <span class="built_in">texture</span>(iChannel0, <span class="type">vec2</span>(x,y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Make sure that you have some texture in <em>iChannel0</em> bellow code editor.<br>Run example, and for sure, it seems pixelated.</p>
<p>Code is actually quite simple.<br>Lines<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> onePixelSizeX = <span class="number">1.0</span> / iResolution.x;</span><br><span class="line"><span class="type">float</span> onePixelSizeY = <span class="number">1.0</span> / iResolution.y;</span><br></pre></td></tr></table></figure></p>
<p> gets normalized size of pixel.</p>
<p>To define cell size use <em>cellSizeX</em> and <em>cellSizeY</em>. Larger cell size results in image appearing more pixelated. </p>
<p>These two lines are majority of fragment shader.</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> x = cellSizeX * <span class="built_in">floor</span>(uv.x / cellSizeX);</span><br><span class="line"><span class="type">float</span> y = cellSizeY * <span class="built_in">floor</span>(uv.y / cellSizeY);</span><br></pre></td></tr></table></figure>
<p>It might be good to break shader down, since it looks bit confusing. It is good idea to work with small samples, which is of course going to hold true for bigger ones as well.</p>
<p>For example, imagine that our screen resolution is 8x6 and that every pixel has some color.<br>Remeber, we’re looking at normalized space, so it takes as 8 pixels on X axis to go from 0 to 1, and 6 pixels on Y axis.</p>
<p><img src="/images/3/image3.png" style="width:75%"></p>
<p>What <em>floor</em> function gives us is rounding. Let’s say for example that our current uv.x is on 5th pixel and uv.y is on 3td one.</p>
<p>That means that x and y would be<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uv.x = 0.125 * 5 = 0.625;</span><br><span class="line">uv.y = 0.166 * 3 = 0.498;</span><br></pre></td></tr></table></figure></p>
<p><em>Floor</em> function will round any number to neareast integer (whole numer).<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">uv.x = 0.625;</span><br><span class="line">uv.y = 0.498;</span><br><span class="line">floor(uv.x / cellSizeX);</span><br><span class="line">floor(0.625 / 0.250);</span><br><span class="line">floor(2.5);</span><br><span class="line"></span><br><span class="line">is 2.</span><br><span class="line"></span><br><span class="line">as you remember in shader code final x is </span><br><span class="line">float x = cellSizeX * floor(uv.x / cellSizeX);</span><br><span class="line"></span><br><span class="line">so </span><br><span class="line">x = 0.250 * 2 = 0.5;</span><br><span class="line"></span><br><span class="line">that means that our 5th x pixel which is on position 0.625 </span><br><span class="line">gets color from the one on position 0.5 (4th one).</span><br><span class="line"></span><br><span class="line">Short version for y.</span><br><span class="line">floor(0.498 / 0.332);</span><br><span class="line">floor(1.5) = 1;</span><br><span class="line"></span><br><span class="line">y = 0.332 * 1 = 0.332;</span><br><span class="line"></span><br><span class="line">So 3td pixel on y, receives color from 2nd one</span><br><span class="line">since coordinate is 0.332 instead of original 0.498.</span><br></pre></td></tr></table></figure></p>
<p>Excatly represented by this.</p>
<p><img src="/images/3/image4.png" style="width:75%"></p>
<p><a href="https://www.shadertoy.com/view/MsKfz3" target="_blank" rel="noopener">Shadertoy example</a>.</p>
<h5 id="Unity"><a href="#Unity" class="headerlink" title="Unity"></a>Unity</h5><p>Now that we know how to create pixelated shader with shadertoy, time to move it somewhere where we might have bigger use for it, Unity in this case.</p>
<p>So how to do it? </p>
<p>Well first we need to know about <em>Render textures</em>. Great now we know that they exists. What are they though ?<br>Just as name says, render textures.<br>Time to render screen into a texture and then apply effects on that texture, like we did with shader toy.</p>
<p><img src="/images/3/image5.png" style="width:75%"></p>
<p>My scene setup for Unity is going to be simple sphere, camera and some directional light.</p>
<p><img src="/images/3/image6.png" style="width:75%"></p>
<p>First I’m going to create script for loading shader.<br>Add C# script to a camera, I have called mine <em>PostProcess</em> but feel free to use any other name.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ExecuteInEditMode</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PostProcess</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Material material;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        material = <span class="keyword">new</span> Material(Shader.Find(<span class="string">"Hidden/Pixelated"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnRenderImage</span>(<span class="params">RenderTexture source, RenderTexture destination</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Graphics.Blit(source, destination, material);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Code here is rather simple, in <em>Awake</em> method we create material and assign shader to it. We still haven’t created shader, but I will call mine <em>‘Pixelated’</em>. So part after <em>“‘Hidden/‘</em> is shader name.</p>
<p><em>OnRenderImage</em> is Unity method for providing source and destination texture. <em>Graphics.Blit</em> copies one texture to another and sets which material/shader to use.</p>
<p>Time to create shader. Go to Assets-&gt;Create-&gt;Shader-&gt;Image Effect Shader and call it <em>Pixelated</em>.</p>
<p>Open it</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Hidden/Pixelated&quot;</span><br><span class="line">&#123;</span><br><span class="line">	Properties</span><br><span class="line">	&#123;</span><br><span class="line">		_MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	SubShader</span><br><span class="line">	&#123;</span><br><span class="line">		// No culling or depth</span><br><span class="line">		Cull Off ZWrite Off ZTest Always</span><br><span class="line"></span><br><span class="line">		Pass</span><br><span class="line">		&#123;</span><br><span class="line">			CGPROGRAM</span><br><span class="line">			#pragma vertex vert</span><br><span class="line">			#pragma fragment frag</span><br><span class="line">			</span><br><span class="line">			#include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">			struct appdata</span><br><span class="line">			&#123;</span><br><span class="line">				float4 vertex : POSITION;</span><br><span class="line">				float2 uv : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			struct v2f</span><br><span class="line">			&#123;</span><br><span class="line">				float2 uv : TEXCOORD0;</span><br><span class="line">				float4 vertex : SV_POSITION;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			v2f vert (appdata v)</span><br><span class="line">			&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.uv = v.uv;</span><br><span class="line">				return o;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			sampler2D _MainTex;</span><br><span class="line"></span><br><span class="line">			fixed4 frag (v2f i) : SV_Target</span><br><span class="line">			&#123;</span><br><span class="line">				fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class="line">				// just invert the colors</span><br><span class="line">				col.rgb = 1 - col.rgb;</span><br><span class="line">				return col;</span><br><span class="line">			&#125;</span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you never wrote shader in Unity, this might seem bit confusing, but it isn’t that hard.<br><em>Properties</em> is used to pass data to shader. In this case texture. We’re going to use <em>properties</em> little bit later.</p>
<p><em>Cull</em>, <em>ZWrite</em> and <em>ZTest</em> are just controlling culling and depth tests. There is already nice <a href="https://docs.unity3d.com/Manual/SL-CullAndDepth.html" target="_blank" rel="noopener">documentation</a> if you’re more interested.</p>
<p><em>Pass</em> is our shader. <em>CGPROGRAM</em> defines start of shader. <em>#pragma vertex vert</em> says that vertex shader function is vert, while <em>#pragma fragment frag</em> does same for fragment shader. We’re going to be working with fragment shader, so <em>frag</em> function is one that we’re going to change.</p>
<p><em>struct</em> are just some data structures, that hold other data. Same as in <em>C#</em>. <em>Vert</em> and <em>frag</em> as already mentioned, are just shader functions.</p>
<p>Take a look into <em>frag</em> function, it might seem similar to shader toy.<br>Where we previously had <em>vec4</em> we now have <em>fixed4</em>. That just defines structure that holds 4 numbers. <em>fixed</em>, <em>half</em> and <em>float</em> are commonly used. Difference between them is in <a href="https://docs.unity3d.com/Manual/SL-DataTypesAndPrecision.html" target="_blank" rel="noopener">precision</a>. </p>
<p>Line <em>tex2D(_MainTex, i.uv)</em> does the same thing as <em>texture(iChannel0, vec2(x,y));</em> in shadertoy. Writing <em>col.rgb</em> is just a handy way of writing <em>col.xyz</em>, think of it as alias. </p>
<p>After adding shader my scene looks like this </p>
<p><img src="/images/3/image7.png" style="width:75%"></p>
<p>You may notice line <em>col.rgb = 1 - col.rgb;</em> in fragment shader. That lines inverts the color and causes this look.</p>
<p>Let’s actually code pixelate shader. It’s good time to add some <em>properties</em> to shader.<br><em>_MainTex</em> is already there, so just add couple of new ones.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Properties</span><br><span class="line">&#123;</span><br><span class="line">	_MainTex(&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">	_ScreenWidth(&quot;screen width&quot;, float) = 320.0</span><br><span class="line">	_ScreenHeight(&quot;screen height&quot;, float) = 240.0</span><br><span class="line">	_CellSizeX(&quot;size of x cell&quot;, float) = 4.0</span><br><span class="line">	_CellSizeY(&quot;size of y cell&quot;, float) = 4.0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Add following before frag shader function, <em>_MainTex</em> is already there, do not duplicate it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sampler2D _MainTex;</span><br><span class="line">float _ScreenWidth;</span><br><span class="line">float _ScreenHeight;</span><br><span class="line">float _CellSizeX;</span><br><span class="line">float _CellSizeY;</span><br></pre></td></tr></table></figure>
<p>Frag function<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fixed4 frag(v2f i) : SV_Target</span><br><span class="line">&#123;</span><br><span class="line">	float2 uv = i.uv;</span><br><span class="line"></span><br><span class="line">	float pixelX = _ScreenWidth / _CellSizeX;</span><br><span class="line">	float pixelY = _ScreenHeight / _CellSizeY;</span><br><span class="line"></span><br><span class="line">	return tex2D(_MainTex, float2(floor(pixelX * uv.x) / pixelX, floor(pixelY * uv.y) / pixelY));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>That is already similar to what we had previously with shadertoy, so refer back to shadertoy example if it’s unclear. Now with lines<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_ScreenWidth(&quot;screen width&quot;, float) = 320.0</span><br><span class="line">_ScreenHeight(&quot;screen height&quot;, float) = 240.0</span><br></pre></td></tr></table></figure></p>
<p>I have assumed that resolution is 320*240, of course that might not be true at all, and we’re going to pass correct that right now.</p>
<p>Change C# script to </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ExecuteInEditMode</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PostProcess</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Vector2 cellSize = <span class="keyword">new</span> Vector2(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Material material;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        material = <span class="keyword">new</span> Material(Shader.Find(<span class="string">"Hidden/Pixelated"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnRenderImage</span>(<span class="params">RenderTexture source, RenderTexture destination</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        material.SetFloat(<span class="string">"_ScreenWidth"</span>, Screen.width);</span><br><span class="line">        material.SetFloat(<span class="string">"_ScreenHeight"</span>, Screen.height);</span><br><span class="line">        material.SetFloat(<span class="string">"_CellSizeX"</span>, cellSize.x);</span><br><span class="line">        material.SetFloat(<span class="string">"_CellSizeY"</span>, cellSize.y);</span><br><span class="line">        Graphics.Blit(source, destination, material);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I have just added <em>cellSize</em> variable and made it accessible in editor and then passed data to our shader variables in <em>OnRenderImage</em> method.</p>
<p><img src="/images/3/image8.png" style="width:75%"></p>
<p>There, some simple post processing effect fully working. Try chaning fragment shader a bit and maybe create some crazy weird effect.</p>
<p>Like always, all code samples are available on line.<br><a href="https://www.shadertoy.com/view/MsKfz3" target="_blank" rel="noopener">Shadertoy</a><br><a href="https://github.com/luka712/Unity-Effects/tree/master/Pixelated%20Shader" target="_blank" rel="noopener">Unity</a></p>
</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.2.0/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="/scripts/index.js" type="text/javascript"></script></body></html>