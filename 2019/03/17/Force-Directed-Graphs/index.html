<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Force Directed Graphs | luka712 blog</title><meta name="description" content="Force directed graphs"><meta name="generator" content="luka712 blog"><meta name="author" content="Luka Erkapic"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage" onload="onLoad()"><header itemscope itemtype="https://schema.org/WPHeader"><h1><a href="/" alt="luka712 blog" title="luka712 blog" itemprop="headline" class="header">luka712 blog</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url" class="header">Home</a></li><li itemprop="name"><a href="/About" alt="About" title="About" itemprop="url" class="header">About</a></li></ul></nav><div id="render-space"><canvas id="render-canvas"></canvas></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Force Directed Graphs</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2019-03-17T15:15:48.000Z"> Sunday, March 17th 2019 at 16:15</time><br>Last updated on<time itemprop="dateModified" datetime="2019-03-17T15:15:48.000Z"> Thursday, May 30th 2019 at 15:46</time></span><h5 id="Force-Directed-Graph"><a href="#Force-Directed-Graph" class="headerlink" title="Force Directed Graph"></a>Force Directed Graph</h5><p>You might already get an idea of what <a href="https://en.wikipedia.org/wiki/Force-directed_graph_drawing" target="_blank" rel="noopener">“Force Directed Graphs”</a> are just from name alone. Force implies that they have something to do with physics. And they do, but without going to much into details, there is wiki read <a href="https://en.wikipedia.org/wiki/Force-directed_graph_drawing" target="_blank" rel="noopener">“Force Directed Graphs”</a>.</p>
<p>My idea with this post is just to create 2 graphs. One of them is going to be more about data, the other one is going to be more related to physics part, without any relevant data actually. For both examples I’m using rather popular <a href="https://d3js.org/" target="_blank" rel="noopener">d3(Data-Driven Documents)</a> library.</p>
<p>First example is showing some fake data about Dinosaurs, that might have lived in same period. FAKE data. Do not use this for any of soon to come exams about dinos, please :). For every example you can try and drag nodes.</p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.js"></script>
<div id="force-directed-graph1"></div>
<script>
function example1(t){var e=[{id:"Tyrannosaurus rex"},{id:"Spinosaurus aegyptiacus"},{id:"Velociraptor mongoliensis"},{id:"Brachiosaurus altithorax"},{id:"Brontosaurus excelsus"},{id:"Stegosaurus stenops"},{id:"Triceratops horridus"},{id:"Iguanadon bernissartensis"},{id:"Parasaurolophus walkeri"},{id:"Ankylosaurus magniventris"}],r=[{source:0,target:1},{source:0,target:4},{source:1,target:4},{source:1,target:5},{source:1,target:6},{source:2,target:7},{source:2,target:8},{source:3,target:9},{source:3,target:1},{source:4,target:5},{source:4,target:2},{source:5,target:7},{source:6,target:5},{source:7,target:8},{source:8,target:0},{source:9,target:3}],n=d3.schemeCategory10,a=d3.forceSimulation(e).force("charge",d3.forceManyBody()).force("link",d3.forceLink(r).distance(200)).force("center",d3.forceCenter().x(400).y(300)),o=d3.select(t).append("svg").attr("width",800).attr("height",600),u=o.selectAll("line").data(r).enter().append("line").style("stroke","#ccc").style("stroke-width",2),c=o.selectAll("g").data(e).enter().append("g"),s=c.append("circle").attr("r",15).style("fill",function(t,e){return n[e]}).call(d3.drag().on("start",function(t){d3.event.active||a.alphaTarget(.25).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||a.alphaTarget(0),t.fx=null,t.fy=null})),i=c.append("text").text(function(t){return t.id}).attr("fill",function(t,e){return n[e]}).attr("font-size",15).attr("font-weight","bold");a.on("tick",function(){u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),s.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),i.attr("x",function(t){return t.x+15}).attr("y",function(t){return t.y+15})})}
</script>

<p>Second example might give you idea for implementing clothes like behaviours for a game or similar project. Of course you would be better with real physics engine here, but still nice example of what can be done with d3. Example is without gravity though. Try dragging nodes to see how physics affect them.</p>

<div id="force-directed-graph2"></div>
<script>
function example2(t){for(var e=[],n=[],r=0;r<10;r++)for(var a=0;a<10;a++)a>0&&n.push({source:10*r+a,target:10*r+a-1}),r>0&&n.push({source:10*r+a,target:10*(r-1)+a}),e.push({id:a+10*r});var c=d3.forceSimulation(e).force("center", d3.forceCenter().x(400).y(300)).force("charge",d3.forceManyBody()).force("link",d3.forceLink(n).strength(1).distance(40).iterations(15)),o=d3.select(t).append("svg").attr("width",800).attr("height",600),i=o.selectAll("circle").data(e).enter().append("circle").attr("r",10).call(d3.drag().on("start",function(t){d3.event.active||c.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||c.alphaTarget(0),t.fx=null,t.fy=null})),u=o.selectAll("line").data(n).enter().append("line").style("stroke","#000").style("stroke-width",1);c.on("tick",function(){u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),i.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})})};
</script>

<h5 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h5><p>For start you’re going to need basic html page.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  // Code goes here</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>From now on all code examples that I write should go inside <em>script</em> element. Also note reference to d3 library in head section.</p>
<p>For start add </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">800</span>,</span><br><span class="line">        height = <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> radius = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sourceNodes = [</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Tyrannosaurus rex"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Spinosaurus aegyptiacus"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Velociraptor mongoliensis"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Brachiosaurus altithorax"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Brontosaurus excelsus"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Stegosaurus stenops"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Triceratops horridus"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Iguanadon bernissartensis"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Parasaurolophus walkeri"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"id"</span>: <span class="string">"Ankylosaurus magniventris"</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> links = [</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">0</span>, <span class="string">"target"</span>: <span class="number">1</span> &#125;, <span class="comment">// Tyrannosaurus rex -&gt; Spinosaurus aegyptiacus</span></span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">0</span>, <span class="string">"target"</span>: <span class="number">4</span> &#125;, <span class="comment">// etc... s</span></span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">4</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">6</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">2</span>, <span class="string">"target"</span>: <span class="number">7</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">2</span>, <span class="string">"target"</span>: <span class="number">8</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">3</span>, <span class="string">"target"</span>: <span class="number">9</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">3</span>, <span class="string">"target"</span>: <span class="number">1</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">4</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">4</span>, <span class="string">"target"</span>: <span class="number">2</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">5</span>, <span class="string">"target"</span>: <span class="number">7</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">6</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">7</span>, <span class="string">"target"</span>: <span class="number">8</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">8</span>, <span class="string">"target"</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"source"</span>: <span class="number">9</span>, <span class="string">"target"</span>: <span class="number">3</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You are probably already familiar with <em>onload</em> call, but if not, it is just an event that is fired off when a browser loads. Everything inside a function will be executed on browser load.</p>
<p>Going from that, <em>width</em> and <em>height</em> will be width and height of graph container. <em>Radius</em> will be size of node, more on that later.</p>
<p><em>SourceNodes</em> is array of data that’s going to be used for example. If you never worked with <em>d3</em>, <em>id</em> property might look like something mandatory, but it’s actually not. It could easily be a <em>name</em> property or <em>myDogLovesToBark</em> property. Point is, <em>d3</em> really makes it map data as you please, as you will see a bit later.</p>
<p><em>Links</em> is just a mapping from source to target, it represents connection between the nodes.</p>
<p>After <em>links</em> variable add</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> colors = d3.schemeCategory10;</span><br><span class="line"><span class="keyword">var</span> simulation = d3.forceSimulation(sourceNodes)</span><br><span class="line">    .force(<span class="string">"charge"</span>, d3.forceManyBody())</span><br><span class="line">    .force(<span class="string">"link"</span>, d3.forceLink(links).distance(<span class="number">200</span>))</span><br><span class="line">    .force(<span class="string">"center"</span>, d3.forceCenter().x(width / <span class="number">2</span>).y(height / <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<p><em>d3.schemeCategory10</em> just provides array of 10 predefined colors in hex format. </p>
<p>The real work is <em>forceSimulation</em> call. That will create physics engine for d3 which can be configured with certain forces that will act upon it, meaning changing position and velocity of nodes. There are 5 forces defined by <em>d3</em></p>

<ul style="list-style:disc; padding-left:20px">
    <li>Centering</li>
    <li>Collision</li>
    <li>Links</li>
    <li>Many-Body</li>
    <li>Positioning</li>
</ul>

<p>with ability to make custom ones. </p>
<p>Short summary of ones that are used here.</p>
<p><strong>forceManyBody</strong> applies mutual forces amongst nodes. That means attraction or repulsion between nodes. Attraction and repulsion can be configured with calling <em>strength</em> function, which is -30 by default. Positive strength simulates attraction, while negative one simulate repulsion.</p>
<p><strong>forceLink</strong> pushes linked nodes together or apart according to link distance. Meaning it creates spring like behaviour between nodes.</p>
<p><strong>center</strong> centers position of nodes at given x and y coordinates. (0,0) by default.</p>
<p>For more try checking out <a href="https://github.com/d3/d3-force" target="_blank" rel="noopener">d3-force github page</a>, since explaining everything would be outside of scope of this post. </p>
<p>Try changing values and dragging nodes to see how some parameters affect the graph. </p>
 
    <label>Strength</label>
    <input id="example3_strength" type="number" value="-30">
    <label>Distance</label>
    <input id="example3_distance" type="number" value="200">
    <br>
    <label>Pos x</label>
    <input id="example3_x" type="range" min="0" max="800" value="400">
    <label>Pos y</label>
    <input id="example3_y" type="range" min="0" max="600" value="300">
    <div id="force-directed-graph3"></div>
    <script>function example3(e){var t=[{id:"Tyrannosaurus rex"},{id:"Spinosaurus aegyptiacus"},{id:"Velociraptor mongoliensis"},{id:"Brachiosaurus altithorax"},{id:"Brontosaurus excelsus"},{id:"Stegosaurus stenops"},{id:"Triceratops horridus"},{id:"Iguanadon bernissartensis"},{id:"Parasaurolophus walkeri"},{id:"Ankylosaurus magniventris"}],r=[{source:0,target:1},{source:0,target:4},{source:1,target:4},{source:1,target:5},{source:1,target:6},{source:2,target:7},{source:2,target:8},{source:3,target:9},{source:3,target:1},{source:4,target:5},{source:4,target:2},{source:5,target:7},{source:6,target:5},{source:7,target:8},{source:8,target:0},{source:9,target:3}],n=d3.schemeCategory10,a=d3.forceSimulation(t).force("charge",d3.forceManyBody()).force("link",d3.forceLink(r).distance(200)).force("center",d3.forceCenter().x(400).y(300));document.getElementById("example3_strength").onchange=function(e){a.force("charge",d3.forceManyBody().strength(Number(this.value))),a.restart()},document.getElementById("example3_distance").onchange=function(e){a.force("link",d3.forceLink(r).distance(Number(this.value))),a.restart()};document.getElementById("example3_x").onchange=function(e){var t=Number(this.value);a.force("center",d3.forceCenter().x(t).y(300)),a.restart()},document.getElementById("example3_y").onchange=function(e){var t=Number(this.value);a.force("center",d3.forceCenter().x(400).y(t)),a.restart()};var o=d3.select(e).append("svg").attr("width",800).attr("height",600),c=o.selectAll("line").data(r).enter().append("line").style("stroke","#ccc").style("stroke-width",2),u=o.selectAll("g").data(t).enter().append("g"),i=u.append("circle").attr("r",15).style("fill",function(e,t){return n[t]}).call(d3.drag().on("start",function(e){d3.event.active||a.alphaTarget(.25).restart(),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=d3.event.x,e.fy=d3.event.y}).on("end",function(e){d3.event.active||a.alphaTarget(0),e.fx=null,e.fy=null})),s=u.append("text").text(function(e){return e.id}).attr("fill",function(e,t){return n[t]}).attr("font-size",15).attr("font-weight","bold");a.on("tick",function(){c.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),i.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),s.attr("x",function(e){return e.x+15}).attr("y",function(e){return e.y+15})})}</script>
 
<p>Next step in code is to add <em>svg</em> container element, since we’re drawing <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element" target="_blank" rel="noopener">svg</a> elements with d3.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> svg = d3.select(<span class="string">'body'</span>)</span><br><span class="line">         .append(<span class="string">"svg"</span>)</span><br><span class="line">         .attr(<span class="string">"width"</span>, width)</span><br><span class="line">         .attr(<span class="string">"height"</span>, height);</span><br></pre></td></tr></table></figure>
<p>This simply selects <em>body</em> element of main page (body element is pretty much page itself) and adds <em>svg</em> element of given width and height.</p>
<p>Next add</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> circlesGroup = svg.selectAll(<span class="string">"g"</span>)</span><br><span class="line">    .data(sourceNodes)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"g"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circles = circlesGroup</span><br><span class="line">    .append(<span class="string">"circle"</span>)</span><br><span class="line">    .attr(<span class="string">"r"</span>, radius)</span><br><span class="line">    .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> colors[i];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>First of all, where to start since this looks confusing. There is select statment for elements that not exsist yet ? Why <em>g</em> ?</p>
<p><em>g</em> is just svg way of grouping elements, since we’re going to add labels on circle later, so it makes more sense to have a single group. For example</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">circle</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>Some text<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>won’t work. Text would not render in this case.<br>But</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">cirle</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>Some text<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>will. By moving <em>g</em> everything inside <em>g</em> is moved, since it is a grouping.</p>
<p>Now you might be wondering about this code </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this was added earlier.</span></span><br><span class="line"><span class="keyword">var</span> circlesGroup = svg.selectAll(<span class="string">"g"</span>)</span><br><span class="line">    .data(sourceNodes)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"g"</span>);</span><br></pre></td></tr></table></figure>
<p>How is it that there is a select statement if elements are still not added. <em>d3</em> works like that, elements can be referenced before they’re even added. Imortant things is to provide <em>data</em> source, call <em>enter</em> and then <em>append</em> elements. You’re going to see following pattern a lot when working with <em>d3</em>.</p>
<ol>
<li>select</li>
<li>data</li>
<li>enter</li>
<li>append</li>
</ol>
<p>Moving forward with post, I’m going to skip through some details, since lot of them are self-explanatory.<br>Like <em>attr(“r”, radius)</em> call, it’s quite obvious that it sets radius of circle.</p>
<p>Next step is to setup actual simulation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">simulation.on(<span class="string">"tick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    circles.attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span><br><span class="line">        .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Thing to note here is that <em>d</em> parameter is d3 object with aditional properties assigned by simulation.<br>Following properties are assigned:</p>

<ul style="list-style:disc; padding-left:20px">
<li>index - node index</li>
<li>x - node current x position</li>
<li>y - node current y position</li>
<li>vx - node current x velocity</li>
<li>vy - node current y velocity</li>
</ul>

<p>The call <em>attr(“cx”, function (d) { return d.x; })</em> is actually mapping from physics space to drawing space. Physics simulations, when it comes to programming do not have anything to do with drawing actually. Physics simulation exists in it’s own seperate world. What this is actually saying is, map <em>x</em> from physics world to attribute <em>cx</em> of circle ( position in draw world).</p>
<p>It just happens that physics world coordinates here corespond to draw world coordinates. You might imagine that more advanced physics engines might take measures in real world units, which then need to be mapped to drawing world, and you would be correct. </p>
<p>After all of that, you should have following on screen by now.</p>
<p><img src="/images/13/image1.png" style="width:50%"></p>
<p>Add code for lines and labels.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lines = svg.selectAll(<span class="string">"line"</span>)</span><br><span class="line">          .data(links)</span><br><span class="line">          .enter()</span><br><span class="line">          .append(<span class="string">"line"</span>)</span><br><span class="line">          .style(<span class="string">"stroke"</span>, <span class="string">"#ccc"</span>)</span><br><span class="line">          .style(<span class="string">"stroke-width"</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = circlesGroup.append(<span class="string">"text"</span>).text(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.id; &#125;)</span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> colors[i];</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">"font-size"</span>, <span class="number">15</span>)</span><br><span class="line">    .attr(<span class="string">"font-weight"</span>, <span class="string">"bold"</span>);</span><br></pre></td></tr></table></figure>
<p>I have already explained select, data, enter pattern. Only difference here being that instead of creating circles, we’re creating lines. Code for labels (text elements ) is bit different, as it is appended to before mentioned group with circles. </p>
<p>Now lines and text still need to be updated inside a simulation. So add following to <em>tick</em> call.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lines.attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span><br><span class="line">    .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span><br><span class="line">    .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span><br><span class="line">    .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span><br><span class="line"></span><br><span class="line">text.attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span><br></pre></td></tr></table></figure>
<p>If you run it, you get something like this.</p>
<p><img src="/images/13/image2.png" style="width:50%"></p>
<p>It does look bit wrong but it’s easy fix. Just moves <em>lines</em> creation code before circles.<br>To fix text overlapping, set offset position to text elements, let’s say in amount of radius.</p>
<p>Change text update inside tick method to</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text.attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x + radius; &#125;)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y + radius; &#125;);</span><br></pre></td></tr></table></figure>
<p>Try to run code again </p>
<p><img src="/images/13/image3.png" style="width:50%"></p>
<p>Perfect. Now this is great, but also bit boring. Let’s make nodes draggable.</p>
<p>Change circles call to following</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circles = circlesGroup</span><br><span class="line">         .append(<span class="string">"circle"</span>)</span><br><span class="line">         .attr(<span class="string">"r"</span>, radius)</span><br><span class="line">         .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">return</span> colors[i];</span><br><span class="line">         &#125;)</span><br><span class="line">         .call(d3.drag()</span><br><span class="line">             .on(<span class="string">"start"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                 simulation.alphaTarget(<span class="number">0.25</span>).restart();</span><br><span class="line">                 d.fx = d.x;</span><br><span class="line">                 d.fy = d.y;</span><br><span class="line">             &#125;)</span><br><span class="line">             .on(<span class="string">"drag"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                 d.fx = d3.event.x;</span><br><span class="line">                 d.fy = d3.event.y;</span><br><span class="line">             &#125;)</span><br><span class="line">             .on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                 simulation.alphaTarget(<span class="number">0</span>);</span><br><span class="line">                 d.fx = <span class="literal">null</span>;</span><br><span class="line">                 d.fy = <span class="literal">null</span>;</span><br><span class="line">             &#125;));</span><br></pre></td></tr></table></figure>
<p><em>d3.drag</em> is just a d3 dragging functionality. Here it has start, drag and end events.<br>In start we essentially restart simulation with alpha target. Quick explenation of alpha is, that it is a value that <em>d3.force</em> uses internally to know when to end simulation, which is also used for velocity and friction calculation.<br>More on that on <a href="https://github.com/d3/d3-force#simulation_alpha" target="_blank" rel="noopener">github page</a>. <em>Restart</em> naturally restart simulation.</p>
<p>Important note is also that <em>fx</em> and <em>fy</em> property are now used, which means fixed x and fixed y. Those property will “fix” position of node. That means to no forces will be applied to node. Those properties can be “unfixed” by simple setting them to null, and that is done on drag end.</p>
<p>All code so far</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> width = <span class="number">800</span>,</span></span><br><span class="line"><span class="undefined">                height = 600;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> radius = <span class="number">15</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> sourceNodes = [</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Tyrannosaurus rex"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Spinosaurus aegyptiacus"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Velociraptor mongoliensis"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Brachiosaurus altithorax"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Brontosaurus excelsus"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Stegosaurus stenops"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Triceratops horridus"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Iguanadon bernissartensis"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Parasaurolophus walkeri"</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"id"</span>: <span class="string">"Ankylosaurus magniventris"</span> &#125;,</span></span><br><span class="line"><span class="undefined">            ];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> links = [</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">0</span>, <span class="string">"target"</span>: <span class="number">1</span> &#125;, <span class="comment">// Tyrannosaurus rex -&gt; Spinosaurus aegyptiacus</span></span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">0</span>, <span class="string">"target"</span>: <span class="number">4</span> &#125;, <span class="comment">// etc... s</span></span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">4</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">1</span>, <span class="string">"target"</span>: <span class="number">6</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">2</span>, <span class="string">"target"</span>: <span class="number">7</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">2</span>, <span class="string">"target"</span>: <span class="number">8</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">3</span>, <span class="string">"target"</span>: <span class="number">9</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">3</span>, <span class="string">"target"</span>: <span class="number">1</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">4</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">4</span>, <span class="string">"target"</span>: <span class="number">2</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">5</span>, <span class="string">"target"</span>: <span class="number">7</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">6</span>, <span class="string">"target"</span>: <span class="number">5</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">7</span>, <span class="string">"target"</span>: <span class="number">8</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">8</span>, <span class="string">"target"</span>: <span class="number">0</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="string">"source"</span>: <span class="number">9</span>, <span class="string">"target"</span>: <span class="number">3</span> &#125;,</span></span><br><span class="line"><span class="undefined">            ];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> colors = d3.schemeCategory10;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> simulation = d3.forceSimulation(sourceNodes)</span></span><br><span class="line"><span class="javascript">                .force(<span class="string">"charge"</span>, d3.forceManyBody())</span></span><br><span class="line"><span class="javascript">                .force(<span class="string">"link"</span>, d3.forceLink(links).distance(<span class="number">200</span>))</span></span><br><span class="line"><span class="javascript">                .force(<span class="string">"center"</span>, d3.forceCenter().x(width / <span class="number">2</span>).y(height / <span class="number">2</span>));</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> svg = d3.select(<span class="string">'body'</span>)</span></span><br><span class="line"><span class="javascript">                .append(<span class="string">"svg"</span>)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"width"</span>, width)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"height"</span>, height);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> lines = svg.selectAll(<span class="string">"line"</span>)</span></span><br><span class="line"><span class="undefined">                .data(links)</span></span><br><span class="line"><span class="undefined">                .enter()</span></span><br><span class="line"><span class="javascript">                .append(<span class="string">"line"</span>)</span></span><br><span class="line"><span class="javascript">                .style(<span class="string">"stroke"</span>, <span class="string">"#ccc"</span>)</span></span><br><span class="line"><span class="javascript">                .style(<span class="string">"stroke-width"</span>, <span class="number">2</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> circlesGroup = svg.selectAll(<span class="string">"g"</span>)</span></span><br><span class="line"><span class="undefined">                .data(sourceNodes)</span></span><br><span class="line"><span class="undefined">                .enter()</span></span><br><span class="line"><span class="javascript">                .append(<span class="string">"g"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> circles = circlesGroup</span></span><br><span class="line"><span class="javascript">                .append(<span class="string">"circle"</span>)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"r"</span>, radius)</span></span><br><span class="line"><span class="javascript">                .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> colors[i];</span></span><br><span class="line"><span class="undefined">                &#125;)</span></span><br><span class="line"><span class="undefined">                .call(d3.drag()</span></span><br><span class="line"><span class="javascript">                    .on(<span class="string">"start"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                        simulation.alphaTarget(0.25).restart();</span></span><br><span class="line"><span class="undefined">                        d.fx = d.x;</span></span><br><span class="line"><span class="undefined">                        d.fy = d.y;</span></span><br><span class="line"><span class="undefined">                    &#125;)</span></span><br><span class="line"><span class="javascript">                    .on(<span class="string">"drag"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                        d.fx = d3.event.x;</span></span><br><span class="line"><span class="undefined">                        d.fy = d3.event.y;</span></span><br><span class="line"><span class="undefined">                    &#125;)</span></span><br><span class="line"><span class="javascript">                    .on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                        simulation.alphaTarget(0);</span></span><br><span class="line"><span class="javascript">                        d.fx = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">                        d.fy = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined">                    &#125;));</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> text = circlesGroup.append(<span class="string">"text"</span>).text(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.id; &#125;)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> colors[i];</span></span><br><span class="line"><span class="undefined">                &#125;)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"font-size"</span>, <span class="number">15</span>)</span></span><br><span class="line"><span class="javascript">                .attr(<span class="string">"font-weight"</span>, <span class="string">"bold"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            simulation.on(<span class="string">"tick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                circles.attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span></span><br><span class="line"><span class="javascript">                    .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                lines.attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span></span><br><span class="line"><span class="javascript">                    .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span></span><br><span class="line"><span class="javascript">                    .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span></span><br><span class="line"><span class="javascript">                    .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                text.attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x + radius; &#125;)</span></span><br><span class="line"><span class="javascript">                    .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y + radius; &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>And final example.</p>
 
<div id="force-directed-graph4"></div>
<script>
function example4(t){var e=[{id:"Tyrannosaurus rex"},{id:"Spinosaurus aegyptiacus"},{id:"Velociraptor mongoliensis"},{id:"Brachiosaurus altithorax"},{id:"Brontosaurus excelsus"},{id:"Stegosaurus stenops"},{id:"Triceratops horridus"},{id:"Iguanadon bernissartensis"},{id:"Parasaurolophus walkeri"},{id:"Ankylosaurus magniventris"}],r=[{source:0,target:1},{source:0,target:4},{source:1,target:4},{source:1,target:5},{source:1,target:6},{source:2,target:7},{source:2,target:8},{source:3,target:9},{source:3,target:1},{source:4,target:5},{source:4,target:2},{source:5,target:7},{source:6,target:5},{source:7,target:8},{source:8,target:0},{source:9,target:3}],n=d3.schemeCategory10,a=d3.forceSimulation(e).force("charge",d3.forceManyBody()).force("link",d3.forceLink(r).distance(200)).force("center",d3.forceCenter().x(400).y(300)),o=d3.select(t).append("svg").attr("width",800).attr("height",600),u=o.selectAll("line").data(r).enter().append("line").style("stroke","#ccc").style("stroke-width",2),c=o.selectAll("g").data(e).enter().append("g"),s=c.append("circle").attr("r",15).style("fill",function(t,e){return n[e]}).call(d3.drag().on("start",function(t){d3.event.active||a.alphaTarget(.25).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||a.alphaTarget(0),t.fx=null,t.fy=null})),i=c.append("text").text(function(t){return t.id}).attr("fill",function(t,e){return n[e]}).attr("font-size",15).attr("font-weight","bold");a.on("tick",function(){u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),s.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),i.attr("x",function(t){return t.x+15}).attr("y",function(t){return t.y+15})})}
</script>

<h5 id="Second-example"><a href="#Second-example" class="headerlink" title="Second example"></a>Second example</h5><p>With this example, we’re just going to connect bunch of nodes. You can use it as inspiration for <a href="https://graphics.stanford.edu/~mdfisher/cloth.html" target="_blank" rel="noopener">clothes simulation</a>, although in 2d. Since majority of code is the same, this is going to be quick.</p>
<p>Starting point </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> w = <span class="number">800</span>,</span><br><span class="line">        h = <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> gridX = <span class="number">10</span>,</span><br><span class="line">        gridY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> nodesSource = [];</span><br><span class="line">    <span class="keyword">var</span> links = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> simulation = d3.forceSimulation(nodesSource)</span><br><span class="line">        .force(<span class="string">"center"</span>, d3.forceCenter().x(w / <span class="number">2</span>).y(h / <span class="number">2</span>))</span><br><span class="line">        .force(<span class="string">"charge"</span>, d3.forceManyBody())</span><br><span class="line">        .force(<span class="string">"link"</span>, d3.forceLink(links).strength(<span class="number">1</span>).distance(<span class="number">40</span>).iterations(<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> svg = d3.select(<span class="string">'body'</span>)</span><br><span class="line">        .append(<span class="string">"svg"</span>)</span><br><span class="line">        .attr(<span class="string">"width"</span>, w)</span><br><span class="line">        .attr(<span class="string">"height"</span>, h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> nodes = svg.selectAll(<span class="string">"circle"</span>)</span><br><span class="line">        .data(nodesSource)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">"circle"</span>)</span><br><span class="line">        .attr(<span class="string">"r"</span>, <span class="number">10</span>)</span><br><span class="line">        .call(d3.drag()  </span><br><span class="line">            .on(<span class="string">"start"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!d3.event.active) simulation.alphaTarget(<span class="number">0.25</span>).restart();</span><br><span class="line">                d.fx = d.x;</span><br><span class="line">                d.fy = d.y;</span><br><span class="line">            &#125;)</span><br><span class="line">            .on(<span class="string">"drag"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                d.fx = d3.event.x;</span><br><span class="line">                d.fy = d3.event.y;</span><br><span class="line">            &#125;)</span><br><span class="line">            .on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!d3.event.active) simulation.alphaTarget(<span class="number">0</span>);</span><br><span class="line">                d.fx = <span class="literal">null</span>;</span><br><span class="line">                d.fy = <span class="literal">null</span>;</span><br><span class="line">            &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> edges = svg.selectAll(<span class="string">"line"</span>)</span><br><span class="line">        .data(links)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">"line"</span>)</span><br><span class="line">        .style(<span class="string">"stroke"</span>, <span class="string">"#000"</span>)</span><br><span class="line">        .style(<span class="string">"stroke-width"</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    simulation.on(<span class="string">"tick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        edges.attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span><br><span class="line">            .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span><br><span class="line">            .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span><br><span class="line">            .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span><br><span class="line"></span><br><span class="line">    nodes.attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span><br><span class="line">        .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Only new thing, compared to previous example is <em>iterations</em> call where link is defined. That is just forcing simulation to run longer.</p>
<p>There are also <em>gridX</em> and <em>gridY</em> variables, which are just limits for nodes. Nodes will be added as grid of 10 rows and 10 columns. </p>
<p>Now, after <em>nodesSource</em> and <em>links</em> declaration add the following.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; gridX; x++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> y = <span class="number">0</span>; y &lt; gridY; y++) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              links.push(&#123;</span><br><span class="line">                  source: gridX * x + y, <span class="attr">target</span>: gridX * x + y - <span class="number">1</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              links.push(&#123;</span><br><span class="line">                  source: (gridX * x) + y, <span class="attr">target</span>: (gridX * (x - <span class="number">1</span>)) + y</span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          nodesSource.push(&#123; <span class="attr">id</span>: y + gridX * x &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>This is adding nodes as rows and columns. Math is rather easy, I recommend working it out on sheet of paper, at least part with links if it’s not clear. </p>
<p>And that’s it actually.</p>

<div id="force-directed-graph5"></div>
<script>
function example5(t){for(var e=[],n=[],r=0;r<10;r++)for(var a=0;a<10;a++)a>0&&n.push({source:10*r+a,target:10*r+a-1}),r>0&&n.push({source:10*r+a,target:10*(r-1)+a}),e.push({id:a+10*r});var c=d3.forceSimulation(e).force("charge",d3.forceManyBody()).force("center", d3.forceCenter().x(400).y(300)).force("link",d3.forceLink(n).strength(1).distance(40).iterations(15)),o=d3.select(t).append("svg").attr("width",800).attr("height",600),i=o.selectAll("circle").data(e).enter().append("circle").attr("r",8).call(d3.drag().on("start",function(t){d3.event.active||c.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||c.alphaTarget(0),t.fx=null,t.fy=null})),u=o.selectAll("line").data(n).enter().append("line").style("stroke","#000").style("stroke-width",1);c.on("tick",function(){u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),i.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})})}
</script>
 
<p>As always, code examples are available on <a href="https://github.com/luka712/d3-force-directed-graphs" target="_blank" rel="noopener">github</a>.<br>Also available on codepen. <a href="https://codepen.io/luka712/pen/xBmvjP" target="_blank" rel="noopener">First example</a>, <a href="https://codepen.io/luka712/pen/zbygME" target="_blank" rel="noopener">second example</a>.</p>

<script>
window.addEventListener("load", function(){
    example1("#force-directed-graph1");
    example2("#force-directed-graph2");
    example3("#force-directed-graph3");
    example4("#force-directed-graph4");
    example5("#force-directed-graph5");
});

</script>

</article></main><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/3.3.0-alpha.12/babylon.js"></script><script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script><script src="https://cdn.jsdelivr.net/npm/babylonjs-gui@3.3.0/babylon.gui.min.js"></script><script src="/scripts/index.js" type="text/javascript"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-121717766-1');ga('send','pageview');</script></body></html>